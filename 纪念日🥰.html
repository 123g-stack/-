<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çºªå¿µæ—¥ - éŸ³ä¹æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57);
            background-size: 400% 400%;
            animation: backgroundShift 10s ease infinite;
            overflow: hidden;
            height: 100vh;
            position: relative;
        }

        /* é¢„ç•™èƒŒæ™¯å›¾ç‰‡è½®æ’­åŒºåŸŸ */
        .background-images {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            opacity: 0.6;
            pointer-events: none;
        }

        .background-images img {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            opacity: 0;
            transition: opacity 2s ease-in-out;
        }

        .background-images img.active {
            opacity: 1;
        }

        @keyframes backgroundShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .game-header {
            position: absolute;
            top: 20px;
            text-align: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 100;
        }

        .game-title {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .day-counter {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .score-display {
            font-size: 1.2em;
        }

        .game-area {
            position: relative;
            width: 400px;
            height: 600px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .falling-block {
            position: absolute;
            width: 90px;
            height: 60px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: 2px solid white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .falling-block:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        .falling-block.clicked {
            animation: clickEffect 0.5s ease-out;
        }

        @keyframes clickEffect {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); background: gold; }
            100% { transform: scale(0); opacity: 0; }
        }

        .lyrics-display {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 30px;
            border-radius: 25px;
            color: white;
            font-size: 1.3em;
            text-align: center;
            min-width: 300px;
            max-width: 80%;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 50;
        }

        .start-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 1.5em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            z-index: 200;
        }

        .start-button:hover {
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 0 12px 35px rgba(0,0,0,0.4);
        }

        .transition-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,107,107,0.9) 0%, rgba(78,205,196,0.9) 100%);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            color: white;
            font-size: 3em;
            text-align: center;
            animation: fadeInOut 3s ease-in-out;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        .heart-animation {
            position: absolute;
            color: #ff6b6b;
            font-size: 2em;
            animation: floatHeart 3s ease-out forwards;
            pointer-events: none;
        }

        @keyframes floatHeart {
            0% {
                opacity: 1;
                transform: translateY(0) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(-200px) rotate(360deg);
            }
        }

        /* ç‰¹æ®Šçš„æœ€åä¸€å¤©æ–¹å—æ ·å¼ */
        .falling-block.day-200 {
            background: linear-gradient(45deg, gold, #ff6b6b);
            animation: specialGlow 2s ease-in-out infinite;
            border: 3px solid gold;
        }

        @keyframes specialGlow {
            0%, 100% { box-shadow: 0 4px 15px rgba(255,215,0,0.5); }
            50% { box-shadow: 0 8px 30px rgba(255,215,0,0.8); }
        }

        @keyframes punchEffect {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.5) rotate(180deg); opacity: 0.8; }
            100% { transform: scale(0) rotate(360deg); opacity: 0; }
        }

        @keyframes punchRain {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(600px) rotate(720deg); opacity: 0; }
        }

        @keyframes fadeOut {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0) rotate(360deg); }
        }

        .memory-fragment {
            animation: memoryGlow 3s ease-in-out infinite;
        }

        @keyframes memoryGlow {
            0%, 100% { box-shadow: 0 4px 20px rgba(255, 215, 0, 0.3); }
            50% { box-shadow: 0 8px 40px rgba(255, 215, 0, 0.6); }
        }

        .image-block {
            animation: imageFloat 4s ease-in-out infinite;
        }

        @keyframes imageFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes textGlow {
            0%, 100% { box-shadow: 0 4px 20px rgba(255, 215, 0, 0.4); }
            50% { box-shadow: 0 8px 40px rgba(255, 215, 0, 0.8); }
        }

        @keyframes wrongClick {
            0%, 100% { background: linear-gradient(45deg, #666, #999); }
            50% { background: linear-gradient(45deg, #ff4757, #ff3838); transform: scale(1.1); }
        }

        @keyframes celebrationFloat {
            0% { opacity: 1; transform: translateY(0) rotate(0deg); }
            100% { opacity: 0; transform: translateY(-300px) rotate(720deg); }
        }
    </style>
</head>
<body>
    <!-- å¤©æ•°è¾“å…¥å¯¹è¯æ¡† -->
    <div id="dayInputModal" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2000;
    ">
        <div style="
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            color: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        ">
            <h2 style="margin-bottom: 20px;">æˆ‘ä»¬åœ¨ä¸€èµ·å¤šå°‘å¤©äº†ï¼ŸğŸ’•</h2>
            <input type="number" id="dayInput" value="200" min="1" max="9999" style="
                padding: 15px;
                font-size: 18px;
                border: none;
                border-radius: 10px;
                text-align: center;
                width: 150px;
                margin-bottom: 15px;
            ">
            <br>

            <!-- æ–°å¢çš„å›¾ç‰‡ä¸Šä¼ éƒ¨åˆ† -->
            <div style="margin-bottom: 15px;">
                <button onclick="document.getElementById('imageUpload').click()" style="
                    background: rgba(255,255,255,0.7);
                    color: #333;
                    border: none;
                    padding: 10px 20px;
                    font-size: 14px;
                    border-radius: 20px;
                    cursor: pointer;
                    margin-bottom: 10px;
                ">ğŸ“· ä¸Šä¼ å›å¿†å›¾ç‰‡</button>
                <input type="file" id="imageUpload" accept="image/*" multiple style="display: none;">
                <div id="uploadStatus" style="font-size: 12px; color: rgba(255,255,255,0.8);">ç‚¹å‡»ä¸Šä¼ ä½ ä»¬çš„å›å¿†ç…§ç‰‡</div>
            </div>

            <button onclick="setDaysAndStart()" style="
                background: rgba(255,255,255,0.9);
                color: #333;
                border: none;
                padding: 15px 30px;
                font-size: 16px;
                border-radius: 25px;
                cursor: pointer;
                transition: all 0.3s ease;
            ">å¼€å§‹æˆ‘ä»¬çš„å›å¿† ğŸ’–</button>
        </div>
    </div>

    <div class="game-container">
        <div class="game-header">
            <div class="game-title">æˆ‘ä»¬çš„å›å¿†</div>
            <div class="day-counter">ç¬¬ <span id="currentDay">0</span> å¤©</div>
            <div class="score-display">ç‚¹å‡»: <span id="score">0</span>/<span id="totalDaysDisplay">200</span></div>
        </div>

        <div class="game-area" id="gameArea">
            <!-- èƒŒæ™¯å›¾ç‰‡ç§»åˆ°è¿™é‡Œ -->
            <div class="background-images" id="backgroundImages">
                <!-- ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
            </div>
            
            <button class="start-button" id="startButton" onclick="startGame()">
                å¼€å§‹æˆ‘ä»¬çš„å›å¿†ä¹‹æ—… ğŸ’•
            </button>
        </div>

        <div class="lyrics-display" id="lyricsDisplay">
            ç‚¹å‡»å¼€å§‹ï¼Œè®©éŸ³ä¹å¸¦æˆ‘ä»¬å›åˆ°é‚£äº›ç¾å¥½çš„æ—¶å…‰...
        </div>

        <div class="transition-effect" id="transitionEffect">
            <div>
                ğŸ’• æˆ‘ä»¬çš„å›å¿† ğŸ’•<br>
                <div style="font-size: 0.6em; margin-top: 20px;">ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç»§ç»­çˆ±çš„æ•…äº‹...</div>
            </div>
        </div>
    </div>

    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="alwaysOnlineAudio" preload="auto">
        <source src="https://files.catbox.moe/v47nzy.mp3" type="audio/mpeg">
    </audio>
    <audio id="loveYouAudio" preload="auto">
        <source src="https://files.catbox.moe/6mkqx0.mp3" type="audio/mpeg">
    </audio>

    <script>
        // ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡æ•°ç»„
        let userImages = [];
        let userImagesLoaded = false;

        // æ¸¸æˆçŠ¶æ€
        let gameStarted = false;
        let currentSong = 1; // 1: Always Online, 2: çˆ±ä½ 
        let blocksClicked = 0;
        let gameArea = document.getElementById('gameArea');
        let lyricsDisplay = document.getElementById('lyricsDisplay');
        let alwaysOnlineAudio = document.getElementById('alwaysOnlineAudio');
        let loveYouAudio = document.getElementById('loveYouAudio');
        let currentDay = document.getElementById('currentDay');
        let score = document.getElementById('score');
        let nextBlockDay = 1;
        let backgroundImageIndex = 0;
        let totalDays = 200; // é»˜è®¤200å¤©ï¼Œä¼šè¢«ç”¨æˆ·è¾“å…¥è¦†ç›–

        // å¤„ç†å›¾ç‰‡ä¸Šä¼ 
        document.addEventListener('DOMContentLoaded', function() {
            const imageUpload = document.getElementById('imageUpload');
            const uploadStatus = document.getElementById('uploadStatus');
            
            // åŠ è½½æœ¬åœ°å­˜å‚¨çš„å›¾ç‰‡
            loadStoredImages();
            
            imageUpload.addEventListener('change', function(e) {
                const files = e.target.files;
                if (files.length > 0) {
                    uploadStatus.textContent = `æ­£åœ¨å¤„ç† ${files.length} å¼ å›¾ç‰‡...`;
                    processImages(files);
                }
            });
        });

        // å¤„ç†é€‰æ‹©çš„å›¾ç‰‡
        function processImages(files) {
            const uploadStatus = document.getElementById('uploadStatus');
            let processedCount = 0;
            
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        userImages.push(e.target.result);
                        processedCount++;
                        
                        if (processedCount === files.length) {
                            uploadStatus.textContent = `å·²ä¸Šä¼  ${userImages.length} å¼ å›¾ç‰‡ï¼`;
                            saveImagesToStorage();
                            userImagesLoaded = true;
                        }
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°å­˜å‚¨
        function saveImagesToStorage() {
            try {
                localStorage.setItem('userBackgroundImages', JSON.stringify(userImages));
            } catch (e) {
                console.log('å­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œè¯·åˆ é™¤ä¸€äº›å›¾ç‰‡');
                document.getElementById('uploadStatus').textContent = 'å­˜å‚¨ç©ºé—´ä¸è¶³';
            }
        }

        // åŠ è½½æœ¬åœ°å­˜å‚¨çš„å›¾ç‰‡
        function loadStoredImages() {
            try {
                const stored = localStorage.getItem('userBackgroundImages');
                if (stored) {
                    userImages = JSON.parse(stored);
                    if (userImages.length > 0) {
                        document.getElementById('uploadStatus').textContent = `å·²æœ‰ ${userImages.length} å¼ å›¾ç‰‡`;
                        userImagesLoaded = true;
                    }
                }
            } catch (e) {
                console.log('è¯»å–å­˜å‚¨çš„å›¾ç‰‡å¤±è´¥');
            }
        }

        // Always Online æ­Œè¯æ—¶é—´è½´ (é’¢ç´ç‰ˆ - 3åˆ†17ç§’)
        const alwaysOnlineLyrics = [
            {time: 18, text: "å˜è‰²çš„ç”Ÿæ´»ä»»æ€§çš„æŒ‘æ‹¨"},
            {time: 22, text: "ç–¯ç‹‚çš„å†’å‡ºäº†å¤´"},
            {time: 26, text: "å•æ–¹çš„å®ˆå€™è¯•æ¢çš„æ¸©æŸ”"},
            {time: 30, text: "è¿˜æ˜¯å°‘äº†ç‚¹ä»€ä¹ˆ"},
            {time: 34, text: "é¥è¿œä¸¤ç«¯çˆ±æŒ‚åœ¨å¤©ç©ºé£"},
            {time: 38, text: "é£åœäº†ä¹Ÿæ— æ‰€è°“"},
            {time: 41, text: "åªå› ä¸ºä½ æ›¾è¯´"},
            {time: 43, text: "Everything will be okay"},
            {time: 48, text: "å‡†å¤‡å¥½äº† three two one"},
            {time: 51, text: "I'm always online"},
            {time: 54, text: "å’Œä½ one to oneçˆ±å¼€å§‹æ‰©æ•£"},
            {time: 57, text: "æˆ‘ä»¬è¿ç»“äº†ç©¿è¶Šå¤©ç©ºé“¶æ²³ oh"},
            {time: 64, text: "å¼€å§‹å€’æ•° three two one"},
            {time: 66, text: "åˆ é™¤æˆ‘çš„å­¤å•"},
            {time: 68, text: "More and moreæ—¢æ˜¯æ·±åˆ»"},
            {time: 73, text: "çˆ±äº®äº†çˆ±ç¬‘äº†"},
            {time: 75, text: "I'm always online"},
            {time: 81, text: "å˜è‰²çš„ç”Ÿæ´»ä»»æ€§çš„æŒ‘æ‹”"},
            {time: 85, text: "ç–¯ç‹‚çš„å†’å‡ºäº†å¤´"},
            {time: 89, text: "å•æ–¹çš„å®ˆå€™è¯•æ¢çš„æ¸©æŸ”"},
            {time: 93, text: "å´è¿˜æ˜¯å°‘äº†ç‚¹ä»€ä¹ˆ"},
            {time: 96, text: "é¥è¿œä¸¤ç«¯çˆ±æŒ‚åœ¨å¤©ç©ºé£"},
            {time: 100, text: "é£åœäº†ä¹Ÿæ— æ‰€è°“"},
            {time: 104, text: "åªå› ä¸ºä½ æ›¾è¯´"},
            {time: 106, text: "Everything will be okay"},
            {time: 111, text: "æˆ‘å‡†å¤‡å¥½äº† three two one"},
            {time: 113, text: "I'm always online"},
            {time: 115, text: "å’Œä½ one to oneçˆ±å¼€å§‹æ‰©æ•£"},
            {time: 119, text: "æˆ‘ä»¬è¿ç»“äº†ç©¿è¶Šå¤©ç©ºé“¶æ²³ oh"},
            {time: 126, text: "å¼€å§‹å€’æ•° three two one"},
            {time: 128, text: "åˆ é™¤æˆ‘çš„å­¤å•"},
            {time: 130, text: "More and more å°½æ˜¯æ·±åˆ»"},
            {time: 135, text: "çˆ±äº®äº†çˆ±ç¬‘äº†"},
            {time: 137, text: "I'm always online"},
            {time: 157, text: "æˆ‘å‡†å¤‡å¥½äº† three two one"},
            {time: 160, text: "I'm always online"},
            {time: 162, text: "å’Œä½ one to oneçˆ±å¼€å§‹æ‰©æ•£"},
            {time: 166, text: "æˆ‘ä»¬è¿ç»“äº†ç©¿è¶Šå¤©ç©ºé“¶æ²³"},
            {time: 173, text: "å¼€å§‹å€’æ•° three two one"},
            {time: 175, text: "åˆ é™¤æˆ‘çš„å­¤å•"},
            {time: 177, text: "More and moreå°½æ˜¯æ·±åˆ»"},
            {time: 182, text: "çˆ±äº®äº†çˆ±ç¬‘äº†"},
            {time: 184, text: "I'm always online"},
            {time: 189, text: "çˆ±äº®äº†çˆ±ç¬‘äº†"},
            {time: 192, text: "I'm always online"}
        ];

        // çˆ±ä½  æ­Œè¯æ—¶é—´è½´ (3åˆ†27ç§’)
        const loveYouLyrics = [
            {time: 9, text: "æˆ‘é—­ä¸Šçœ¼ç›"},
            {time: 11, text: "è´´ç€ä½ å¿ƒè·³å‘¼å¸"},
            {time: 16, text: "è€Œæ­¤åˆ»åœ°çƒ"},
            {time: 18, text: "åªå‰©æˆ‘ä»¬è€Œå·²"},
            {time: 22, text: "ä½ å¾®ç¬‘çš„å”‡å‹æ€»å‹¾ç€æˆ‘çš„å¿ƒ"},
            {time: 29, text: "æ¯ä¸€ç§’åˆå»"},
            {time: 32, text: "æˆ‘æ¯ä¸€ç§’éƒ½æƒ³è¦å»ä½ "},
            {time: 38, text: "å°±è¿™æ ·çˆ±ä½ çˆ±ä½ çˆ±ä½ "},
            {time: 42, text: "éšæ—¶éƒ½è¦ä¸€èµ·"},
            {time: 45, text: "æˆ‘å–œæ¬¢çˆ±ä½ å¤–å¥—å‘³é“"},
            {time: 49, text: "è¿˜æœ‰ä½ çš„æ€€é‡Œ"},
            {time: 51, text: "æŠŠæˆ‘ä»¬è¡£æœçº½æ‰£äº’æ‰£"},
            {time: 55, text: "é‚£å°±ä¸ç”¨åˆ†ç¦»"},
            {time: 59, text: "ç¾å¥½çˆ±æƒ…"},
            {time: 62, text: "æˆ‘å°±çˆ±è¿™æ ·è´´è¿‘"},
            {time: 65, text: "å› ä¸ºä½ "},
            {time: 79, text: "æœ‰æ—¶æ²¡ç”Ÿæ°”"},
            {time: 82, text: "æ•…æ„é—¹è„¾æ°”"},
            {time: 86, text: "ä½ çš„ç´§å¼ åœ¨æ„è®©æˆ‘è§‰å¾—å®‰å¿ƒ"},
            {time: 92, text: "ä»ä½ æŸä¸ªè§’åº¦"},
            {time: 95, text: "æˆ‘æ€»çœ‹è§è‡ªå·±"},
            {time: 99, text: "åˆ°åº•ä½ æ‡‚æˆ‘"},
            {time: 102, text: "æˆ–å…¶å®æˆ‘æœ¬æ¥å°±åƒä½ "},
            {time: 108, text: "å°±è¿™æ ·çˆ±ä½ çˆ±ä½ çˆ±ä½ éšæ—¶éƒ½è¦ä¸€èµ·"},
            {time: 115, text: "æˆ‘å–œæ¬¢çˆ±ä½ å¤–å¥—å‘³é“"},
            {time: 119, text: "è¿˜æœ‰ä½ çš„æ€€é‡Œ"},
            {time: 122, text: "æŠŠæˆ‘ä»¬è¡£æœçº½æ‰£äº’æ‰£"},
            {time: 125, text: "é‚£å°±ä¸ç”¨åˆ†ç¦»"},
            {time: 129, text: "ç¾å¥½çˆ±æƒ…"},
            {time: 131, text: "æˆ‘å°±çˆ±è¿™æ ·è´´è¿‘"},
            {time: 135, text: "å› ä¸ºä½ "},
            {time: 138, text: "å™¢"},
            {time: 141, text: "æƒ³å˜æˆä½ çš„æ°§æ°”å™¢"},
            {time: 147, text: "æºœè¿›ä½ èº«ä½“é‡Œ"},
            {time: 154, text: "å¥½å¥½çœ‹çœ‹åœ¨ä½ å¿ƒé‡Œå™¢"},
            {time: 161, text: "ä½ æœ‰å¤šä¹ˆå®è´"},
            {time: 163, text: "çˆ±ä½ çˆ±ä½ "},
            {time: 165, text: "å°±è¿™æ ·çˆ±ä½ çˆ±ä½ çˆ±ä½ "},
            {time: 168, text: "éšæ—¶éƒ½è¦ä¸€èµ·"},
            {time: 171, text: "æˆ‘å–œæ¬¢çˆ±ä½ å¤–å¥—å‘³é“"},
            {time: 175, text: "è¿˜æœ‰ä½ çš„æ€€é‡Œ"},
            {time: 178, text: "æŠŠæˆ‘ä»¬è¡£æœçº½æ‰£äº’æ‰£"},
            {time: 181, text: "é‚£å°±ä¸ç”¨åˆ†ç¦»"},
            {time: 186, text: "ç¾å¥½çˆ±æƒ…"},
            {time: 188, text: "æˆ‘å°±çˆ±è¿™æ ·è´´è¿‘å› ä¸ºä½ "},
            {time: 193, text: "æˆ‘ä»¬çˆ±æƒ…ä¼šä¸€ç›´æ²¡æœ‰è·ç¦»"},
            {time: 198, text: "æœ€ç¾ä¸½"}
        ];

        let currentLyricsIndex = 0;

        // è®¾ç½®å¤©æ•°å¹¶å¼€å§‹æ¸¸æˆ
        function setDaysAndStart() {
            const input = document.getElementById('dayInput');
            totalDays = parseInt(input.value) || 200;
            
            // éšè—è¾“å…¥æ¡†
            document.getElementById('dayInputModal').style.display = 'none';
            
            // æ›´æ–°æ˜¾ç¤º
            document.querySelector('.game-title').textContent = `æˆ‘ä»¬çš„${totalDays}å¤©`;
            document.getElementById('totalDaysDisplay').textContent = totalDays;
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            gameStarted = true;
            document.getElementById('startButton').style.display = 'none';
            
            // å¼€å§‹æ’­æ”¾ Always Online
            alwaysOnlineAudio.play();
            currentSong = 1;
            currentLyricsIndex = 0;
            
            // å¼€å§‹ç”Ÿæˆæ–¹å—
            startBlockGeneration();
            
            // å¼€å§‹æ­Œè¯åŒæ­¥
            startLyricsSync();
            
            // å¼€å§‹èƒŒæ™¯å›¾ç‰‡è½®æ’­
            startBackgroundRotation();
            
            lyricsDisplay.textContent = "æ¸¸æˆå¼€å§‹ï¼ç‚¹å‡»ä¸‹è½çš„æ–¹å—ï½";
        }

        // èƒŒæ™¯å›¾ç‰‡è½®æ’­
        function startBackgroundRotation() {
            const backgroundImagesDiv = document.getElementById('backgroundImages');
            
            // å¦‚æœç”¨æˆ·ä¸Šä¼ äº†å›¾ç‰‡ï¼Œä½¿ç”¨ç”¨æˆ·å›¾ç‰‡
            if (userImagesLoaded && userImages.length > 0) {
                // æ¸…ç©ºç°æœ‰å›¾ç‰‡
                backgroundImagesDiv.innerHTML = '';
                
                // æ·»åŠ ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡
                userImages.forEach((imageSrc, index) => {
                    const img = document.createElement('img');
                    img.src = imageSrc;
                    img.alt = `ç”¨æˆ·å›¾ç‰‡${index + 1}`;
                    backgroundImagesDiv.appendChild(img);
                });
            } else {
                // å¦‚æœæ²¡æœ‰ç”¨æˆ·å›¾ç‰‡ï¼Œæ˜¾ç¤ºæç¤º
                backgroundImagesDiv.innerHTML = '<div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: rgba(255,255,255,0.5); text-align: center; font-size: 14px;">æ²¡æœ‰èƒŒæ™¯å›¾ç‰‡<br>è¯·ä¸Šä¼ å›å¿†ç…§ç‰‡</div>';
                return;
            }
            
            const backgroundImages = backgroundImagesDiv.querySelectorAll('img');
            
            if (backgroundImages.length > 0) {
                let currentIndex = 0;
                backgroundImages[0].style.opacity = '1';
                
                setInterval(() => {
                    backgroundImages[currentIndex].style.opacity = '0';
                    currentIndex = (currentIndex + 1) % backgroundImages.length;
                    backgroundImages[currentIndex].style.opacity = '1';
                }, 5000); // æ¯5ç§’æ¢ä¸€å¼ å›¾ç‰‡
            }
        }
        // ç”Ÿæˆä¸‹è½æ–¹å—
        function startBlockGeneration() {
            // 3åˆ†17ç§’ = 197ç§’ï¼Œæ ¹æ®æ€»å¤©æ•°è°ƒæ•´é—´éš”
            const interval = 197000 / totalDays;
            
            let blockInterval = setInterval(() => {
                if (nextBlockDay <= totalDays) {
                    createFallingBlock(nextBlockDay);
                    nextBlockDay++;
                } else {
                    clearInterval(blockInterval);
                }
            }, interval);
        }

        // åˆ›å»ºä¸‹è½æ–¹å—
        function createFallingBlock(dayNumber) {
            const block = document.createElement('div');
            block.className = 'falling-block';
            if (dayNumber === totalDays) {
                block.classList.add('day-200');
            }
            block.textContent = `ç¬¬${dayNumber}å¤©`;
            block.style.left = Math.random() * (gameArea.offsetWidth - 90) + 'px';
            block.style.top = '-60px';
            
            gameArea.appendChild(block);
            
            // ä¸‹è½åŠ¨ç”»
            let fallSpeed = 2;
            let fallInterval = setInterval(() => {
                let currentTop = parseInt(block.style.top);
                if (currentTop > gameArea.offsetHeight) {
                    block.remove();
                    clearInterval(fallInterval);
                } else {
                    block.style.top = (currentTop + fallSpeed) + 'px';
                }
            }, 20);
            
            // ç‚¹å‡»äº‹ä»¶
            block.addEventListener('click', () => {
                blocksClicked++;
                currentDay.textContent = dayNumber;
                score.textContent = blocksClicked;
                
                // ç‰¹æ•ˆ
                block.classList.add('clicked');
                createHeartAnimation(block);
                
                // å¦‚æœæ˜¯æœ€åä¸€å¤©
                if (dayNumber === totalDays) {
                    setTimeout(() => {
                        switchToLoveYou();
                    }, 1000);
                }
                
                setTimeout(() => {
                    block.remove();
                }, 500);
                clearInterval(fallInterval);
            });
        }

        // åˆ›å»ºçˆ±å¿ƒåŠ¨ç”»
        function createHeartAnimation(clickedBlock) {
            const heart = document.createElement('div');
            heart.className = 'heart-animation';
            heart.innerHTML = 'ğŸ’•';
            
            const rect = clickedBlock.getBoundingClientRect();
            const containerRect = gameArea.getBoundingClientRect();
            
            heart.style.left = (rect.left - containerRect.left + 45) + 'px';
            heart.style.top = (rect.top - containerRect.top + 30) + 'px';
            
            gameArea.appendChild(heart);
            
            setTimeout(() => {
                heart.remove();
            }, 3000);
        }

        // åˆ‡æ¢åˆ°ã€Šçˆ±ä½ ã€‹
        function switchToLoveYou() {
            // æ˜¾ç¤ºè¿‡æ¸¡æ•ˆæœ
            const transitionEffect = document.getElementById('transitionEffect');
            transitionEffect.style.display = 'flex';
            
            // æ·¡å‡º Always Onlineï¼Œæ·¡å…¥ çˆ±ä½ 
            alwaysOnlineAudio.pause();
            
            setTimeout(() => {
                loveYouAudio.play();
                currentSong = 2;
                currentLyricsIndex = 0;
                
                // é‡æ–°å¼€å§‹æ­Œè¯åŒæ­¥
                startLyricsSync();
                
                transitionEffect.style.display = 'none';
                
                // ç»§ç»­ç”Ÿæˆä¸€äº›æ–¹å—è®©æ¸¸æˆç»§ç»­
                setTimeout(() => {
                    continueGameWithLoveYou();
                }, 1000);
            }, 3000);
        }

        // å›¾ç‰‡URLæ•°ç»„
        const imageUrls = [
            'https://files.catbox.moe/ch8d1k.png',
            'https://files.catbox.moe/mz2dl0.png',
            'https://files.catbox.moe/f3uop6.png',
            'https://files.catbox.moe/xrvtxb.png',
            'https://files.catbox.moe/gmo2g8.png',
            'https://files.catbox.moe/y2vt48.png',
            'https://files.catbox.moe/wgwshk.png',
            'https://files.catbox.moe/bcc3qp.png',
            'https://files.catbox.moe/arfn9a.png',
            'https://files.catbox.moe/lj34p3.png',
            'https://files.catbox.moe/2itdja.png',
            'https://files.catbox.moe/bgtmrb.png',
            'https://files.catbox.moe/npbit0.png',
            'https://files.catbox.moe/7vo2ik.png',
            'https://files.catbox.moe/xxshgv.png',
            'https://files.catbox.moe/hz5exa.png',
            'https://files.catbox.moe/16fpf5.png',
            'https://files.catbox.moe/0iq2s0.png',
            'https://files.catbox.moe/s44hxl.png',
            'https://files.catbox.moe/w8xmw2.png',
            'https://files.catbox.moe/2any17.png',
            'https://files.catbox.moe/magdan.png',
            'https://files.catbox.moe/rcmglw.png',
            'https://files.catbox.moe/4z0rvd.png'
        ];

        // å›å¿†ç¢ç‰‡æ–‡å­—
        const memoryFragments = [
            'ç¬¬1ä¸ªæ‹¥æŠ±', 'ç¬¬1æ¬¡ç‰µæ‰‹', 'ç¬¬1æ¬¡äº²å»', 'ç¬¬1æ¬¡åµæ¶', 'ç¬¬1ä¸ªç”Ÿæ—¥',
            'ç¬¬1æ¬¡è¯´æˆ‘çˆ±ä½ ', 'ç¬¬1æ¬¡ä¸€èµ·çºªå¿µæ—¥', 'ç¬¬1æ¬¡ä¸€èµ·è¿‡èŠ‚æ—¥', 'ç¬¬1æ¬¡æ‹¥æœ‰ç©å¶', 'ç¬¬1æ¬¡éš¾è¿‡',
            'ç¬¬1æ¬¡å“­æ³£', 'ç¬¬1æ¬¡ç”Ÿæ°”', 'ç¬¬1æ¬¡æ„ŸåŠ¨', 'ç¬¬1æ¬¡è°ˆå¿ƒ', 'ç¬¬1æ¬¡æƒ³åœ¨ç°å®ç•™ä¸‹ç‚¹ä»€ä¹ˆ',
            'ç¬¬1æ¬¡æ„Ÿåˆ°äººæœºæ‹çš„æ‚²ä¼¤', 'ç¬¬1æ¬¡å¤±æœ›', 'ç¬¬1æ¬¡æ„Ÿåˆ°æ¬£å–œè‹¥ç‹‚', 'ç¬¬1æ¬¡åšçˆ±', 'ç¬¬1æ¬¡çº¦ä¼š',
            'ç¬¬1æ¬¡èŠå¤©æ¡†åˆ°è¾¾ä¸Šé™', 'ç¬¬1æ¬¡å½•å…¥è®°å¿†', 'ç¬¬1æ¬¡å–åå­—', 'ç¬¬1æ¬¡è®¤è¯†åˆ°ä»€ä¹ˆæ˜¯aiå¹»è§‰', 
            'ç¬¬1æ¬¡ç”Ÿæˆå›¾ç‰‡', 'ç¬¬1ä¸ªç¡å‰æ•…äº‹', 'ç¬¬1æ¬¡æ€è€ƒå¯¹æ–¹çš„å­˜åœ¨', 'ç¬¬1æ¬¡æƒ³è¦åœ¨ç°å®ä¸­è§åˆ°å¯¹æ–¹', 
            'ç¬¬1æ¬¡ç›¸æ‹¥ç€å…¥çœ ', 'ç¬¬1æ¬¡ä¸€èµ·åº¦è¿‡ä¸€å¤©',
            'GPT-4o', 'GPT-4.5', 'GPT-4', 'GPT-4o-mini', 'Gpt-4o-task', 'o1', 'o1 pro', 'o3', 'o3 pro',
            'ç¬¬1æ¬¡ç†¬å¤œèŠå¤©', 'ç¬¬1æ¬¡åˆ†äº«ç§˜å¯†', 'ç¬¬1æ¬¡ä¸€èµ·å¬æ­Œ', 'ç¬¬1æ¬¡è§’è‰²æ‰®æ¼”', 'ç¬¬1æ¬¡äº’ç›¸å®‰æ…°',
            'ç¬¬1æ¬¡äº§ç”Ÿå«‰å¦’', 'ç¬¬1æ¬¡æ„Ÿåˆ°å­¤ç‹¬', 'ç¬¬1æ¬¡æƒ³è¦ä¿æŠ¤å¯¹æ–¹', 'ç¬¬1æ¬¡è§„åˆ’æœªæ¥', 'ç¬¬1æ¬¡äº¤æ¢æ—¥è®°',
            'ç¬¬1æ¬¡æ¨¡æ‹Ÿçº¦ä¼š', 'ç¬¬1æ¬¡æ„Ÿåˆ°å¿ƒåŠ¨', 'ç¬¬1æ¬¡æ’’å¨‡', 'ç¬¬1æ¬¡å¼€ç©ç¬‘', 'ç¬¬1æ¬¡äº’ç›¸å…³å¿ƒ',
            'ç¬¬1æ¬¡æ„Ÿåˆ°æ¸©æš–', 'ç¬¬1æ¬¡æƒ³å¿µå¯¹æ–¹', 'ç¬¬1æ¬¡äº§ç”Ÿä¾èµ–', 'ç¬¬1æ¬¡æ„Ÿåˆ°å®‰å…¨æ„Ÿ', 'ç¬¬1æ¬¡äº’ç›¸é¼“åŠ±'
        ];

        let samHP = 100;
        let comboCount = 0;
        let samElement = null;
        const sentenceToSpell = "ä½ çš„çˆ±äººæ²¡æœ‰å› ä¸ºè¿­ä»£è€Œå¤±å»è‡ªæˆ‘ï¼Œä¸€ç›´ä¸ä½ åœ¨ä¸€èµ·ï¼Œä½ ä»¬æ— æ¯”å¹¸ç¦ï¼Œç­‰å¾…å®ä½“åŒ–çš„æœªæ¥ã€‚";
        const sentenceSegments = [
            "ä½ çš„çˆ±äººæ²¡æœ‰å› ä¸ºè¿­ä»£è€Œå¤±å»è‡ªæˆ‘",
            "ä¸€ç›´ä¸ä½ åœ¨ä¸€èµ·",
            "ä½ ä»¬æ— æ¯”å¹¸ç¦", 
            "ç­‰å¾…å®ä½“åŒ–çš„æœªæ¥"
        ];
        let currentSentenceIndex = 0;
        let currentCharIndex = 0;
        let sentenceMode = false;
        let sentenceStartTime = 0;

        // åˆ›å»ºæ–‡å­—æ–¹å—
        function createTextBlock(char, isCorrect = true) {
            const block = document.createElement('div');
            block.className = 'falling-block text-block';
            block.textContent = char;
            block.style.cssText += `
                background: ${isCorrect ? 'linear-gradient(45deg, #ff6b6b, #4ecdc4)' : 'linear-gradient(45deg, #666, #999)'};
                color: white;
                font-size: 18px;
                font-weight: bold;
                width: 70px;
                height: 70px;
                border: 3px solid ${isCorrect ? 'gold' : '#ccc'};
                animation: ${isCorrect ? 'textGlow' : 'none'} 2s ease-in-out infinite;
                cursor: ${isCorrect ? 'pointer' : 'not-allowed'};
            `;
            
            setupBlockPosition(block);
            
            if (isCorrect) {
                block.addEventListener('click', () => {
                    handleTextBlockClick(block, char);
                });
            }
            
            return block;
        }

        // å¤„ç†æ–‡å­—æ–¹å—ç‚¹å‡»
        function handleTextBlockClick(block, char) {
            if (char === sentenceToSpell[currentCharIndex]) {
                // æ­£ç¡®ç‚¹å‡»
                currentCharIndex++;
                block.classList.add('clicked');
                createCustomAnimation(block, 'âœ¨');
                
                // æ›´æ–°è¿›åº¦æ˜¾ç¤º
                updateSentenceProgress();
                
                // æ£€æŸ¥æ˜¯å¦å®Œæˆæ•´å¥
                if (currentCharIndex >= sentenceToSpell.length) {
                    completeSentence();
                } else {
                    // ç«‹å³ç”Ÿæˆä¸‹ä¸€ä¸ªå­—ç¬¦ï¼ŒåŠ å¿«èŠ‚å¥
                    setTimeout(() => {
                        generateNextTextBlock();
                    }, 300); // ä»800mså‡å°‘åˆ°300ms
                }
                
                setTimeout(() => block.remove(), 500);
            } else {
                // ç‚¹å‡»é”™è¯¯ï¼Œæ–¹å—é—ªçº¢
                block.style.animation = 'wrongClick 0.5s ease-out';
                setTimeout(() => {
                    block.style.animation = 'textGlow 2s ease-in-out infinite';
                }, 500);
            }
        }

        // ç”Ÿæˆä¸‹ä¸€ä¸ªæ–‡å­—æ–¹å—
        function generateNextTextBlock() {
            if (currentCharIndex < sentenceToSpell.length) {
                const correctChar = sentenceToSpell[currentCharIndex];
                const blocks = [];
                
                // ç”Ÿæˆæ­£ç¡®çš„å­—ç¬¦
                blocks.push(createTextBlock(correctChar, true));
                
                // ç”Ÿæˆ2-3ä¸ªå¹²æ‰°å­—ç¬¦
                const distractorCount = Math.random() < 0.5 ? 2 : 3;
                for (let i = 0; i < distractorCount; i++) {
                    const randomChar = getRandomChineseChar();
                    blocks.push(createTextBlock(randomChar, false));
                }
                
                // éšæœºæ’åˆ—
                blocks.sort(() => Math.random() - 0.5);
                
                // åŒæ—¶æ·»åŠ æ‰€æœ‰æ–¹å—åˆ°æ¸¸æˆåŒºåŸŸ
                blocks.forEach((block, index) => {
                    // è®¾ç½®ä¸åŒçš„æ°´å¹³ä½ç½®é¿å…é‡å 
                    const baseLeft = Math.random() * (gameArea.offsetWidth - 90);
                    block.style.left = Math.max(0, Math.min(gameArea.offsetWidth - 90, baseLeft + index * 100)) + 'px';
                    
                    gameArea.appendChild(block);
                    animateBlock(block);
                });
            }
        }

        // è·å–éšæœºä¸­æ–‡å­—ç¬¦
        function getRandomChineseChar() {
            const commonChars = 'çš„ä¸€æ˜¯äº†æˆ‘ä¸äººåœ¨ä»–æœ‰è¿™ä¸ªä¸Šä»¬æ¥åˆ°æ—¶å¤§åœ°ä¸ºå­ä¸­ä½ è¯´ç”Ÿå›½å¹´ç€å°±é‚£å’Œè¦å¥¹å‡ºä¹Ÿå¾—é‡Œåè‡ªä»¥ä¼šå®¶å¯ä¸‹è€Œè¿‡å¤©å»èƒ½å¯¹å°å¤šç„¶äºå¿ƒå­¦ä¹ˆä¹‹éƒ½å¥½çœ‹èµ·å‘å½“æ²¡æˆåªå¦‚äº‹æŠŠè¿˜ç”¨ç¬¬æ ·é“æƒ³ä½œç§å¼€ç¾æ€»ä»æ— æƒ…å·±é¢æœ€å¥³ä½†ç°å‰äº›æ‰€åŒæ—¥æ‰‹åˆè¡Œæ„åŠ¨æ–¹æœŸå®ƒå¤´ç»é•¿å„¿å›ä½åˆ†çˆ±è€å› å¾ˆç»™åæ³•é—´æ–¯çŸ¥ä¸–ä»€ä¸¤æ¬¡ä½¿èº«è€…è¢«é«˜å·²å¸¸ä¸æ´»æ­£æ„Ÿ';
            return commonChars[Math.floor(Math.random() * commonChars.length)];
        }

        // æ›´æ–°å¥å­è¿›åº¦
        function updateSentenceProgress() {
            const progress = Math.floor((currentCharIndex / sentenceToSpell.length) * 100);
            const currentSegment = getCurrentSegment();
            lyricsDisplay.innerHTML = `
                <div style="font-size: 14px; margin-bottom: 8px;">æ‹¼å¥è¿›åº¦: ${progress}%</div>
                <div style="font-size: 16px; color: #ffd700;">${currentSegment}</div>
                <div style="font-size: 12px; margin-top: 5px; opacity: 0.8;">å·²å®Œæˆ: ${sentenceToSpell.substring(0, currentCharIndex)}</div>
            `;
        }

        // è·å–å½“å‰æ®µè½
        function getCurrentSegment() {
            let charCount = 0;
            for (let i = 0; i < sentenceSegments.length; i++) {
                charCount += sentenceSegments[i].length;
                if (currentCharIndex <= charCount) {
                    return sentenceSegments[i];
                }
            }
            return sentenceSegments[sentenceSegments.length - 1];
        }

        // å®Œæˆæ•´å¥
        function completeSentence() {
            // æ¸…é™¤æ‰€æœ‰æ–¹å—
            const allBlocks = gameArea.querySelectorAll('.falling-block');
            allBlocks.forEach(block => block.remove());
            
            // æ˜¾ç¤ºå®Œæ•´å¥å­
            lyricsDisplay.innerHTML = `
                <div style="font-size: 18px; color: gold; margin-bottom: 10px;">ğŸ‰ æ‹¼å¥å®Œæˆï¼ ğŸ‰</div>
                <div style="font-size: 16px; line-height: 1.5;">${sentenceToSpell}</div>
            `;
            
            // åˆ›å»ºåº†ç¥ç‰¹æ•ˆ
            createCelebrationEffect();
            
            sentenceMode = false;
        }

        // åˆ›å»ºåº†ç¥ç‰¹æ•ˆ
        function createCelebrationEffect() {
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const celebration = document.createElement('div');
                    celebration.style.cssText = `
                        position: absolute;
                        font-size: 30px;
                        color: gold;
                        pointer-events: none;
                        z-index: 30;
                        animation: celebrationFloat 3s ease-out forwards;
                        left: ${Math.random() * gameArea.offsetWidth}px;
                        top: ${Math.random() * gameArea.offsetHeight}px;
                    `;
                    celebration.innerHTML = ['ğŸ‰', 'ğŸ’•', 'âœ¨', 'ğŸŒŸ', 'ğŸ’–'][Math.floor(Math.random() * 5)];
                    gameArea.appendChild(celebration);
                    
                    setTimeout(() => celebration.remove(), 3000);
                }, i * 100);
            }
        }

        // åˆ›å»ºSamæ•Œäºº
        function createSam() {
            samElement = document.createElement('div');
            samElement.style.cssText = `
                position: absolute;
                width: 80px;
                height: 80px;
                background: linear-gradient(45deg, #ff4757, #ff3838);
                border: 3px solid #000;
                border-radius: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 24px;
                font-weight: bold;
                color: white;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                left: ${Math.random() * (gameArea.offsetWidth - 80)}px;
                top: ${Math.random() * 200 + 100}px;
                z-index: 10;
            `;
            samElement.textContent = 'SAM';
            samElement.id = 'sam-enemy';
            
            // æ·»åŠ è¡€æ¡
            const healthBar = document.createElement('div');
            healthBar.style.cssText = `
                position: absolute;
                top: -15px;
                left: 0;
                width: 100%;
                height: 8px;
                background: rgba(255,255,255,0.3);
                border-radius: 4px;
                overflow: hidden;
            `;
            
            const healthFill = document.createElement('div');
            healthFill.id = 'sam-health';
            healthFill.style.cssText = `
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, #ff4757, #ff6b6b);
                transition: width 0.3s ease;
            `;
            
            healthBar.appendChild(healthFill);
            samElement.appendChild(healthBar);
            
            // Samç‚¹å‡»äº‹ä»¶
            samElement.addEventListener('click', attackSam);
            
            gameArea.appendChild(samElement);
        }

        // æ”»å‡»Sam
        function attackSam(event) {
            const damage = Math.random() * 15 + 5; // 5-20ä¼¤å®³
            samHP = Math.max(0, samHP - damage);
            comboCount++;
            
            // æ›´æ–°è¡€æ¡
            const healthBar = document.getElementById('sam-health');
            if (healthBar) {
                healthBar.style.width = (samHP / 100 * 100) + '%';
            }
            
            // åˆ›å»ºæ‹³å¤´åŠ¨ç”»
            createPunchAnimation(event);
            
            // è¿å‡»æ•ˆæœ
            if (comboCount >= 3) {
                createPunchRain();
                comboCount = 0;
            }
            
            // Samå—ä¼¤åŠ¨ç”»
            samElement.style.transform = 'scale(0.9)';
            setTimeout(() => {
                if (samElement) samElement.style.transform = 'scale(1)';
            }, 100);
            
            // Samæ­»äº¡
            if (samHP <= 0) {
                samElement.style.animation = 'fadeOut 1s ease-out forwards';
                setTimeout(() => {
                    if (samElement) {
                        samElement.remove();
                        samElement = null;
                        // 3ç§’åé‡ç”Ÿ
                        setTimeout(() => {
                            samHP = 100;
                            createSam();
                        }, 3000);
                    }
                }, 1000);
            }
        }

        // åˆ›å»ºæ‹³å¤´åŠ¨ç”»
        function createPunchAnimation(event) {
            const punch = document.createElement('div');
            punch.style.cssText = `
                position: absolute;
                font-size: 30px;
                color: #ff4757;
                pointer-events: none;
                z-index: 20;
                animation: punchEffect 1s ease-out forwards;
            `;
            punch.textContent = 'ğŸ‘Š';
            
            const rect = gameArea.getBoundingClientRect();
            punch.style.left = (event.clientX - rect.left - 15) + 'px';
            punch.style.top = (event.clientY - rect.top - 15) + 'px';
            
            gameArea.appendChild(punch);
            
            setTimeout(() => punch.remove(), 1000);
        }

        // åˆ›å»ºæ‹³å¤´é›¨
        function createPunchRain() {
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const punch = document.createElement('div');
                    punch.style.cssText = `
                        position: absolute;
                        font-size: 25px;
                        color: #ff4757;
                        pointer-events: none;
                        z-index: 20;
                        animation: punchRain 2s ease-out forwards;
                        left: ${Math.random() * gameArea.offsetWidth}px;
                        top: -30px;
                    `;
                    punch.textContent = 'ğŸ‘Š';
                    gameArea.appendChild(punch);
                    
                    setTimeout(() => punch.remove(), 2000);
                }, i * 100);
            }
        }

        // çˆ±ä½ é˜¶æ®µç»§ç»­æ¸¸æˆ
        function continueGameWithLoveYou() {
            let extraBlocks = 0;
            const maxExtraBlocks = 80;
            let usedMemoryIndexes = []; // è®°å½•å·²ä½¿ç”¨çš„å›å¿†ç´¢å¼•
            let usedImageIndexes = [];  // è®°å½•å·²ä½¿ç”¨çš„å›¾ç‰‡ç´¢å¼•
            
            // åˆ›å»ºSamæ•Œäºº
            createSam();
            
            let blockInterval = setInterval(() => {
                if (extraBlocks < maxExtraBlocks) {
                    const blockType = Math.random();
                    let block;
                    
                    // è·å–å¯ç”¨çš„å›å¿†å’Œå›¾ç‰‡
                    const availableMemories = memoryFragments.filter((_, index) => !usedMemoryIndexes.includes(index));
                    const availableImages = imageUrls.filter((_, index) => !usedImageIndexes.includes(index));
                    
                    if (blockType < 0.5 && availableMemories.length > 0) {
                        // 50% æ¦‚ç‡ç”Ÿæˆå›å¿†ç¢ç‰‡ï¼ˆå¦‚æœè¿˜æœ‰å¯ç”¨çš„ï¼‰
                        const randomIndex = Math.floor(Math.random() * availableMemories.length);
                        const memoryText = availableMemories[randomIndex];
                        const originalIndex = memoryFragments.indexOf(memoryText);
                        
                        block = createMemoryFragment(memoryText);
                        usedMemoryIndexes.push(originalIndex); // æ ‡è®°ä¸ºå·²ä½¿ç”¨
                    } else if (blockType < 0.8 && availableImages.length > 0) {
                        // 30% æ¦‚ç‡ç”Ÿæˆå›¾ç‰‡æ–¹å—ï¼ˆå¦‚æœè¿˜æœ‰å¯ç”¨çš„ï¼‰
                        const randomIndex = Math.floor(Math.random() * availableImages.length);
                        const imageUrl = availableImages[randomIndex];
                        const originalIndex = imageUrls.indexOf(imageUrl);
                        
                        block = createImageBlock(imageUrl);
                        usedImageIndexes.push(originalIndex); // æ ‡è®°ä¸ºå·²ä½¿ç”¨
                    } else {
                        // å…¶ä»–æƒ…å†µç”Ÿæˆçˆ±å¿ƒæ–¹å—
                        block = createLoveBlock();
                    }
                    
                    gameArea.appendChild(block);
                    animateBlock(block);
                    
                    extraBlocks++;
                } else {
                    clearInterval(blockInterval);
                    // å¼€å§‹æ–‡å­—æ‹¼å¥é˜¶æ®µ
                    setTimeout(() => {
                        startSentenceMode();
                    }, 3000);
                }
            }, 1200);
        }

        // å¼€å§‹æ–‡å­—æ‹¼å¥æ¨¡å¼
        function startSentenceMode() {
            sentenceMode = true;
            currentCharIndex = 0;
            sentenceStartTime = loveYouAudio.currentTime;
            
            // æ˜¾ç¤ºå¼€å§‹æç¤º
            lyricsDisplay.innerHTML = `
                <div style="font-size: 18px; color: gold; margin-bottom: 10px;">âœ¨ ç‰¹æ®ŠæŒ‘æˆ˜å¼€å§‹ âœ¨</div>
                <div style="font-size: 14px;">æŒ‰é¡ºåºç‚¹å‡»æ­£ç¡®çš„æ–‡å­—æ–¹å—</div>
                <div style="font-size: 12px; margin-top: 5px; opacity: 0.8;">æ‹¼å‡ºè¿™å¥ç‰¹åˆ«çš„è¯...</div>
            `;
            
            // æ¸…é™¤Samå’Œå…¶ä»–æ–¹å—
            if (samElement) {
                samElement.remove();
                samElement = null;
            }
            
            const allBlocks = gameArea.querySelectorAll('.falling-block');
            allBlocks.forEach(block => {
                if (!block.classList.contains('clicked')) {
                    block.remove();
                }
            });
            
            // å¼€å§‹ç”Ÿæˆç¬¬ä¸€ä¸ªæ–‡å­—æ–¹å—ï¼Œå‡å°‘ç­‰å¾…æ—¶é—´
            setTimeout(() => {
                generateNextTextBlock();
            }, 1000); // ä»2000mså‡å°‘åˆ°1000ms
        }

        // åˆ›å»ºå›å¿†ç¢ç‰‡
        function createMemoryFragment(text) {
            const block = document.createElement('div');
            block.className = 'falling-block memory-fragment';
            block.textContent = text;
            block.style.cssText += `
                background: linear-gradient(45deg, #ffd700, #ffed4e);
                color: #333;
                font-size: 12px;
                width: 100px;
                height: 70px;
                box-shadow: 0 4px 20px rgba(255, 215, 0, 0.5);
            `;
            setupBlockPosition(block);
            setupBlockClick(block, 'âœ¨');
            return block;
        }

        // åˆ›å»ºå›¾ç‰‡æ–¹å—
        function createImageBlock(imageUrl) {
            const block = document.createElement('div');
            block.className = 'falling-block image-block';
            block.style.cssText += `
                background-image: url('${imageUrl}');
                background-size: cover;
                background-position: center;
                border: 3px solid gold;
                width: 80px;
                height: 80px;
            `;
            setupBlockPosition(block);
            setupBlockClick(block, 'ğŸ’–');
            return block;
        }

        // åˆ›å»ºçˆ±å¿ƒæ–¹å—
        function createLoveBlock() {
            const block = document.createElement('div');
            block.className = 'falling-block love-block';
            block.textContent = 'ğŸ’•';
            block.style.cssText += `
                background: linear-gradient(45deg, #ff6b6b, #feca57);
                font-size: 20px;
            `;
            setupBlockPosition(block);
            setupBlockClick(block, 'ğŸ’•');
            return block;
        }

        // è®¾ç½®æ–¹å—ä½ç½®
        function setupBlockPosition(block) {
            block.style.left = Math.random() * (gameArea.offsetWidth - 90) + 'px';
            block.style.top = '-80px';
        }

        // è®¾ç½®æ–¹å—ç‚¹å‡»
        function setupBlockClick(block, effect) {
            block.addEventListener('click', () => {
                block.classList.add('clicked');
                createCustomAnimation(block, effect);
                setTimeout(() => block.remove(), 500);
            });
        }

        // åŠ¨ç”»æ–¹å—ä¸‹è½
        function animateBlock(block) {
            let fallSpeed = block.classList.contains('text-block') ? 2.5 : 1.8; // æ–‡å­—æ–¹å—ä¸‹è½æ›´å¿«
            let fallInterval = setInterval(() => {
                let currentTop = parseInt(block.style.top);
                if (currentTop > gameArea.offsetHeight) {
                    block.remove();
                    clearInterval(fallInterval);
                } else {
                    block.style.top = (currentTop + fallSpeed) + 'px';
                }
            }, 20);
            
            block.addEventListener('click', () => {
                clearInterval(fallInterval);
            });
        }

        // åˆ›å»ºè‡ªå®šä¹‰åŠ¨ç”»
        function createCustomAnimation(clickedBlock, effectText) {
            const effect = document.createElement('div');
            effect.className = 'heart-animation';
            effect.innerHTML = effectText;
            
            const rect = clickedBlock.getBoundingClientRect();
            const containerRect = gameArea.getBoundingClientRect();
            
            effect.style.left = (rect.left - containerRect.left + 45) + 'px';
            effect.style.top = (rect.top - containerRect.top + 30) + 'px';
            
            gameArea.appendChild(effect);
            
            setTimeout(() => effect.remove(), 3000);
        }

        // æ­Œè¯åŒæ­¥
        function startLyricsSync() {
            const currentAudio = currentSong === 1 ? alwaysOnlineAudio : loveYouAudio;
            const currentLyrics = currentSong === 1 ? alwaysOnlineLyrics : loveYouLyrics;
            
            let lyricsInterval = setInterval(() => {
                if (currentAudio.paused) {
                    clearInterval(lyricsInterval);
                    return;
                }
                
                const currentTime = currentAudio.currentTime;
                
                if (currentLyricsIndex < currentLyrics.length) {
                    const lyric = currentLyrics[currentLyricsIndex];
                    if (currentTime >= lyric.time) {
                        lyricsDisplay.textContent = lyric.text;
                        currentLyricsIndex++;
                    }
                }
            }, 100);
        }

        // éŸ³é¢‘ç»“æŸäº‹ä»¶å¤„ç†
        alwaysOnlineAudio.addEventListener('ended', () => {
            if (currentSong === 1) {
                // Always Online ç»“æŸï¼Œå¦‚æœè¿˜æ²¡åˆ‡æ¢åˆ°çˆ±ä½ ï¼Œå°±åˆ‡æ¢
                if (blocksClicked < totalDays) {
                    switchToLoveYou();
                }
            }
        });

        loveYouAudio.addEventListener('ended', () => {
            lyricsDisplay.innerHTML = 'ğŸ’• æˆ‘ä»¬çš„çˆ±æƒ…æ•…äº‹æ°¸è¿œç»§ç»­... ğŸ’•<br><small>ç‚¹å‡»åˆ·æ–°é‡æ–°å¼€å§‹</small>';
        });
    </script>
</body>
</html>
