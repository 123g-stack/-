<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”œç”œçš„é­”æ³•æ•…äº‹ä¹å›­ (V14.2 - Gisté“¾æ¥æ›´æ–°)</title>
    <style>
        :root { 
            --primary-bg-color: #e0f7fa; --primary-text-color: #004d40; --theme-accent-color: #00bcd4;
            --feature-bg-color: #ffffff; --feature-border-color: #b2ebf2; --gacha-button-text-color: #004d40; 
            --draw-method-bg-color: #e0f7fa; --draw-method-border-color: #00bcd4; 
            --draw-method-text-color: #00796b; --draw-method-hover-bg-color: #b2ebf2;
            --stamina-bar-bg-color: #00acc1; --story-content-bg-color: #f0f8ff;
            --story-content-border-color: #81d4fa; --placeholder-text-color: #546e7a;
            --story-title-color: var(--theme-accent-color); 
            --module-button-active-bg: var(--theme-accent-color); 
            --module-button-active-text: #ffffff; 
            --module-button-bg: #f0f0f0; 
            --module-button-text: var(--primary-text-color); 
            --pagination-btn-bg: var(--theme-accent-color);
            --pagination-btn-text: #ffffff;
            --pagination-btn-disabled-bg: #cccccc;
            --pagination-btn-disabled-text: #888888;
        }
        body { font-family: 'Microsoft YaHei', sans-serif; margin: 0; padding: 20px; background-color: var(--primary-bg-color); color: var(--primary-text-color); transition: background-color 0.5s ease, color 0.5s ease; }
        h1 { text-align: center; color: var(--theme-accent-color); margin-bottom: 30px; transition: color 0.5s ease; }
        h2 { color: var(--theme-accent-color); border-bottom: 2px solid var(--theme-accent-color); padding-bottom: 5px; margin-bottom: 15px; transition: color 0.5s ease, border-color 0.5s ease; }
        .feature-section { background-color: var(--feature-bg-color); border: 1px solid var(--feature-border-color); padding: 20px; margin-bottom: 20px; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.05); transition: background-color 0.5s ease, border-color 0.5s ease; }
        .story-draw-methods { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
        .draw-method { border: 2px dashed var(--draw-method-border-color); padding: 15px 25px; cursor: pointer; background-color: var(--draw-method-bg-color); color: var(--draw-method-text-color); border-radius: 8px; text-align: center; font-weight: bold; transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease; }
        .draw-method:hover:not(.disabled) { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0,0,0,0.1); background-color: var(--draw-method-hover-bg-color); }
        .draw-method.disabled { cursor: not-allowed; opacity: 0.6; background-color: #ccc !important; border-color: #aaa !important; color: #666 !important; box-shadow: none; transform: none; }
        .draw-method.is-grabbing { animation: claw-machine-rumble 0.7s ease-in-out; }
        @keyframes claw-machine-rumble { 0%, 100% { transform: translateX(0) rotate(0); } 15% { transform: translateX(-4px) rotate(-2deg); } 30% { transform: translateX(4px) rotate(2deg); } 45% { transform: translateX(-3px) rotate(-1deg); } 60% { transform: translateX(3px) rotate(1deg); } 75% { transform: translateX(-2px) rotate(0); } }
        .draw-method.dart-throw-animation { animation: dart-throw 0.5s ease-out; } @keyframes dart-throw { 0%, 100% { transform: translate(0,0) scale(1); } 50% { transform: translate(3px, -3px) scale(1.05); } }
        .draw-method.slot-spin-animation { animation: slot-spin 0.6s linear; } @keyframes slot-spin { 0%, 100% { transform: translateY(0); } 20% { transform: translateY(-4px); } 40% { transform: translateY(4px); }  60% { transform: translateY(-3px); } 80% { transform: translateY(3px); } }
        .draw-method.coin-flip-animation { animation: coin-flip 0.7s ease-in-out; } @keyframes coin-flip { 0% { transform: rotateY(0deg); } 100% { transform: rotateY(360deg); } }
        .draw-method.cat-paw-animation { animation: cat-paw-press 0.4s ease-in-out; } @keyframes cat-paw-press { 0%, 100% { transform: scale(1); box-shadow: 0 2px 5px rgba(0,0,0,0.1); } 50% { transform: scale(0.95, 0.92); box-shadow: inset 0 1px 3px rgba(0,0,0,0.2); } }
        .draw-method.balloon-wiggle-animation { animation: balloon-wiggle 0.7s ease-in-out; } @keyframes balloon-wiggle { 0%, 100% { transform: rotate(0deg) translateX(0); } 20% { transform: rotate(4deg) translateX(2px); } 40% { transform: rotate(-4deg) translateX(-2px); } 60% { transform: rotate(3deg) translateX(1px); } 80% { transform: rotate(-3deg) translateX(-1px); } }
        .theme-buttons .theme-btn { padding: 10px 18px; margin-right: 10px; margin-bottom: 10px; border: 2px solid transparent; border-radius: 8px; cursor: pointer; font-weight: bold; transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease, color 0.3s ease;}
        .theme-buttons .theme-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .theme-buttons .theme-btn.pink { background-color: #ffc0cb; color: #8B008B; } .theme-buttons .theme-btn.blue { background-color: #add8e6; color: #000080; }
        .theme-buttons .theme-btn.green { background-color: #90ee90; color: #006400; } .theme-buttons .theme-btn.orange { background-color: #ffd580; color: #A0522D; }
        .theme-buttons .theme-btn.purple { background-color: #e6e6fa; color: #483D8B; } .theme-buttons .theme-btn.yellow { background-color: #fffacd; color: #B8860B; }
        .theme-buttons .theme-btn.dark { background-color: #555555; color: #ffffff; }
        #stamina-bar-container { width: 100%; background-color: #e0e0e0; border-radius: 8px; height: 28px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1); }
        #stamina-bar { width: 100%; height: 100%; background-color: var(--stamina-bar-bg-color); text-align: center; line-height: 28px; color: white; font-weight: bold; border-radius: 8px; transition: width 0.5s ease, background-color 0.5s ease; }
        #story-content { background-color: var(--story-content-bg-color); padding: 20px; border-left: 6px solid var(--story-content-border-color); min-height: 120px; border-radius: 0 8px 8px 0; transition: background-color 0.5s ease, border-color 0.5s ease; line-height: 1.6; }
        #story-content h3 { margin-top: 0; color: var(--story-title-color); transition: color 0.5s ease; }
        .placeholder-text { color: var(--placeholder-text-color); font-style: italic; font-size: 0.9em; transition: color 0.5s ease; }
        .loading-message { text-align: center; padding: 20px; font-style: italic; color: var(--placeholder-text-color); }
        .gacha-button { display: block; margin: 10px auto 20px auto; padding: 12px 28px; background-color: var(--theme-accent-color); color: var(--gacha-button-text-color); border: none; border-radius: 25px; font-size: 1.1em; font-weight: bold; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: transform 0.2s ease, background-color 0.3s ease, box-shadow 0.2s ease, color 0.3s ease; }
        .gacha-button:hover { transform: scale(1.05) translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.15); filter: brightness(110%); }
        .gacha-button:active { transform: scale(0.98) translateY(0px); }
        #prompt-gacha-display { background-color: var(--story-content-bg-color); border: 2px dashed var(--draw-method-border-color); padding: 25px; border-radius: 8px; min-height: 100px; display: flex; justify-content: center; align-items: center; text-align: center; font-size: 1.15em; color: var(--primary-text-color); line-height: 1.5; box-shadow: inset 0 0 10px rgba(0,0,0,0.03); transition: background-color 0.5s ease, border-color 0.5s ease, color 0.5s ease; }
        .shake-animation { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0) rotate(-1deg); } 20%, 80% { transform: translate3d(2px, 0, 0) rotate(1deg); } 30%, 50%, 70% { transform: translate3d(-2px, 0, 0) rotate(-2deg); } 40%, 60% { transform: translate3d(2px, 0, 0) rotate(2deg); } }
        #paperball-trigger { display: block; width: fit-content; padding: 15px 25px; background-color: var(--draw-method-bg-color); border: 2px dashed var(--draw-method-border-color); border-radius: 10px; cursor: pointer; text-align: center; font-size: 1.2em; font-weight: bold; margin: 0 auto 20px auto; color: var(--draw-method-text-color); transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease; }
        #paperball-trigger:hover { transform: scale(1.05); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .module-buttons-container { display: none; flex-wrap: wrap; gap: 15px; margin-top: 20px; margin-bottom: 20px; justify-content: center; }
        .module-btn { padding: 10px 20px; font-size: 1em; font-weight: bold; border: 2px solid var(--theme-accent-color); border-radius: 8px; cursor: pointer; background-color: var(--module-button-bg); color: var(--module-button-text); transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease; }
        .module-btn:hover { transform: translateY(-2px); filter: brightness(110%); }
        .module-btn.active { background-color: var(--module-button-active-bg); color: var(--module-button-active-text); box-shadow: 0 0 10px var(--module-button-active-bg); }
        .module-content { border: 1px dashed var(--feature-border-color); padding: 15px; margin-top: 10px; border-radius: 8px; background-color: var(--feature-bg-color); display: none; line-height: 1.6; transition: background-color 0.5s ease, border-color 0.5s ease; }
        .module-item-display { min-height: 150px; padding: 10px; margin-bottom: 15px; border-radius: 5px; }
        .module-item-display p, .module-item-display li { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px dotted var(--feature-border-color); }
        .module-item-display p > span:first-child, .module-item-display li > span:first-child { flex-grow: 1; margin-right: 10px; }
        .module-item-display p:last-child, .module-item-display li:last-child { margin-bottom: 0; padding-bottom: 0; border-bottom: none; }
        .module-pagination-controls { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--feature-border-color); }
        .pagination-btn { padding: 8px 16px; background-color: var(--pagination-btn-bg); color: var(--pagination-btn-text); border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: background-color 0.3s ease, transform 0.2s ease, color 0.3s ease; }
        .pagination-btn:hover:not([disabled]) { filter: brightness(110%); transform: translateY(-1px); }
        .pagination-btn:disabled { background-color: var(--pagination-btn-disabled-bg) !important; color: var(--pagination-btn-disabled-text) !important; cursor: not-allowed; opacity: 0.7; }
        .page-info { font-weight: bold; color: var(--primary-text-color); }
        #persona-area { text-align: center; }
        .persona-claw-machine { display: inline-flex; flex-direction: column; align-items: center; padding: 20px; background-color: var(--draw-method-bg-color); border: 3px solid var(--draw-method-border-color); border-radius: 15px; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; margin-bottom: 20px; box-shadow: 0 5px 10px rgba(0,0,0,0.1); }
        .persona-claw-machine:hover { transform: scale(1.03); box-shadow: 0 8px 15px rgba(0,0,0,0.15); }
        .persona-claw-machine .claw-emoji { font-size: 3em; margin-bottom: 10px; display: inline-block; }
        .persona-claw-machine p { margin: 0; font-weight: bold; color: var(--draw-method-text-color); }
        .persona-trait-display-area { margin-top: 15px; padding: 20px; background-color: var(--story-content-bg-color); border: 2px dashed var(--theme-accent-color); border-radius: 8px; min-height: 50px; display: flex; justify-content: center; align-items: center; text-align: center; font-size: 1.2em; font-weight: bold; color: var(--primary-text-color); }
        .persona-machine-shake { animation: machine-shake-strong 0.6s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes machine-shake-strong { 10%, 90% { transform: translate3d(-2px, 0, 0) rotate(-3deg); } 20%, 80% { transform: translate3d(3px, 0, 0) rotate(3deg); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0) rotate(-4deg); } 40%, 60% { transform: translate3d(4px, 0, 0) rotate(4deg); } }
        
        .copy-btn-item { margin-left: 10px; padding: 3px 8px; font-size: 0.8em; background-color: var(--draw-method-hover-bg-color); color: var(--draw-method-text-color); border: 1px solid var(--draw-method-border-color); border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease, color 0.2s ease; flex-shrink: 0; }
        .copy-btn-item:hover { filter: brightness(120%); }
        .copy-btn-module-all { margin-left: 15px; padding: 5px 10px; font-size: 0.9em; background-color: var(--theme-accent-color); color: var(--pagination-btn-text); border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.2s ease, color 0.2s ease; }
        .copy-btn-module-all:hover { filter: brightness(110%); }
        .copy-btn-section { display: block; width: fit-content; margin: 15px auto 5px auto; padding: 8px 15px; font-size: 0.95em; font-weight: bold; background-color: var(--draw-method-bg-color); color: var(--draw-method-text-color); border: 2px dashed var(--draw-method-border-color); border-radius: 8px; cursor: pointer; transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease; }
        .copy-btn-section:hover { background-color: var(--draw-method-hover-bg-color); filter: brightness(105%); }
        .copied-feedback { background-color: #28a745 !important; color: white !important; border-color: #28a745 !important; }
    </style>
</head>
<body>

    <h1>æ¬¢è¿æ¥åˆ°ç”œç”œçš„é­”æ³•æ•…äº‹ä¹å›­ï¼</h1>

    <div class="feature-section" id="theme-selector-area"><h2>ğŸ¨ ä¸»é¢˜é¢œè‰²é€‰æ‹©</h2><div class="theme-buttons"><button class="theme-btn pink" data-theme="pink">ç”œç”œç²‰</button><button class="theme-btn blue" data-theme="blue">å¤©ç©ºè“</button><button class="theme-btn green" data-theme="green">æ£®æ—ç»¿</button><button class="theme-btn orange" data-theme="orange">æ´»åŠ›æ©™</button><button class="theme-btn purple" data-theme="purple">æ˜Ÿç©ºç´«</button><button class="theme-btn yellow" data-theme="yellow">æŸ æª¬é»„</button><button class="theme-btn dark" data-theme="dark">æš—å¤œé»‘</button></div><p class="placeholder-text">ï¼ˆç‚¹å‡»æŒ‰é’®åˆ‡æ¢æ•´ä¸ªé¡µé¢çš„é¢œè‰²ä¸»é¢˜ï¼‰</p></div>
    <div class="feature-section" id="story-draw-area"><h2>âœ¨ æŠ½å–æ•…äº‹çš„æ–¹å¼</h2><div class="story-draw-methods"><div class="draw-method" id="draw-darts">ğŸ¯ é£é•–</div><div class="draw-method" id="draw-slot-machine">ğŸ° è€è™æœº</div><div class="draw-method" id="draw-coin-toss">ğŸª™ æŠ•å¸</div><div class="draw-method" id="draw-cat-paw">ğŸ¾ å–µçˆª</div><div class="draw-method" id="draw-balloon">ğŸˆ æ°”çƒ</div><div class="draw-method" id="draw-claw-machine">ğŸ§¸ å¨ƒå¨ƒæœº</div></div><p class="placeholder-text">ï¼ˆç‚¹å‡»æŒ‰é’®æŠ½å–æ•…äº‹ï¼‰</p></div>
    <div class="feature-section" id="persona-area"><h2>ğŸ­ æˆ‘çš„äººè®¾å¨ƒå¨ƒæœº</h2><div id="persona-claw-machine-trigger" class="persona-claw-machine"><span class="claw-emoji">ğŸ§¸</span><p>ç‚¹å‡»æŠ½å–ä»Šæ—¥äººè®¾ï¼</p></div><div id="persona-trait-display" class="persona-trait-display-area"><p class="placeholder-text">ä»Šå¤©ä¼šæ˜¯ä»€ä¹ˆæ ·çš„æˆ‘å‘¢ï¼Ÿ</p></div><button id="copy-persona-btn" class="copy-btn-section" title="å¤åˆ¶äººè®¾">ğŸ“‹ å¤åˆ¶ä»Šæ—¥äººè®¾</button><p class="placeholder-text" style="text-align:center; margin-top:10px;">ï¼ˆäººè®¾â€œå¥–å“â€ä¼šåœ¨æ•°æ®åŠ è½½åå¯ç”¨ï¼‰</p></div>
    <div class="feature-section" id="stamina-area"><h2>ğŸ’ª ä½“åŠ›å€¼</h2> <p>å½“å‰ä½“åŠ›ï¼š<span id="stamina-value-display">100</span> / 100</p> <div id="stamina-bar-container"><div id="stamina-bar">100%</div></div> <p class="placeholder-text">ï¼ˆæ¯æ¬¡æŠ½å–æ•…äº‹ä¼šæ¶ˆè€—ä½“åŠ›ï¼Œä½“åŠ›ä¼šç¼“æ…¢è‡ªåŠ¨æ¢å¤å“¦ï¼ï¼‰</p></div>
    <div class="feature-section" id="prompt-area"><h2>ğŸ’¡ PromptåŒº (çµæ„Ÿæ‘‡è›‹æœº)</h2> <button id="gacha-prompt-button" class="gacha-button">âœ¨ æ‘‡ä¸ªçµæ„Ÿï¼</button> <div id="prompt-gacha-display"><p class="placeholder-text">ç‚¹æŒ‰é’®æ‘‡Promptå§ï¼</p></div><button id="copy-prompt-btn" class="copy-btn-section" title="å¤åˆ¶çµæ„Ÿ">ğŸ“‹ å¤åˆ¶çµæ„Ÿ</button></div>
    <div class="feature-section" id="story-display-area"><h2>ğŸ“œ æ–‡æ¡ˆåŒº (æ•…äº‹å†…å®¹)</h2><div id="story-content"><p class="placeholder-text">æŠ½åˆ°çš„æ•…äº‹ä¼šæ˜¾ç¤ºåœ¨è¿™ï¼</p></div><button id="copy-story-btn" class="copy-btn-section" title="å¤åˆ¶æ•…äº‹">ğŸ“‹ å¤åˆ¶æ•…äº‹</button></div>
    <div class="feature-section" id="featured-modules-area"> <h2>ğŸ’– ç‰¹è‰²æ¨¡å—æ¢ç´¢</h2><div id="paperball-trigger">ğŸ“„ ç‚¹æˆ‘å±•å¼€é—®å·å…¥å£~</div> <div class="module-buttons-container"> <button class="module-btn" data-module="pureLove">çº¯çˆ±å°å±‹ ğŸŒ¸</button><button class="module-btn" data-module="privateRealm">ç¥ç§˜èŠ±å›­ ğŸ¤«</button> </div><div class="module-content" id="content-pureLove"><h3>æ¬¢è¿æ¥åˆ°çº¯çˆ±å°å±‹ <button class="copy-btn-module-all" id="pureLove-copy-all-btn" title="å¤åˆ¶æœ¬å±‹æ‰€æœ‰æ¡ç›®">ğŸ“‹ å¤åˆ¶å…¨éƒ¨</button></h3><div class="module-item-display" id="pureLove-item-display"><p class="placeholder-text">æ¨¡å—å†…å®¹åŠ è½½ä¸­æˆ–åŠ è½½å¤±è´¥...</p></div><div class="module-pagination-controls"><button class="pagination-btn prev" id="pureLove-prev-btn">&lt; ä¸Šä¸€é¡µ</button><span class="page-info" id="pureLove-page-info"></span><button class="pagination-btn next" id="pureLove-next-btn">ä¸‹ä¸€é¡µ &gt;</button></div><p class="placeholder-text" style="margin-top:15px;">ï¼ˆç‰¹è‰²æ¨¡å—æ¡ç›®ä¼šä»GiståŠ è½½ï¼‰</p></div><div class="module-content" id="content-privateRealm"><h3>æ¢ç´¢ç¥ç§˜èŠ±å›­ <button class="copy-btn-module-all" id="privateRealm-copy-all-btn" title="å¤åˆ¶æœ¬å›­æ‰€æœ‰æ¡ç›®">ğŸ“‹ å¤åˆ¶å…¨éƒ¨</button></h3><div class="module-item-display" id="privateRealm-item-display"><p class="placeholder-text">æ¨¡å—å†…å®¹åŠ è½½ä¸­æˆ–åŠ è½½å¤±è´¥...</p></div><div class="module-pagination-controls"><button class="pagination-btn prev" id="privateRealm-prev-btn">&lt; ä¸Šä¸€é¡µ</button><span class="page-info" id="privateRealm-page-info"></span><button class="pagination-btn next" id="privateRealm-next-btn">ä¸‹ä¸€é¡µ &gt;</button></div><p class="placeholder-text" style="margin-top:15px;">ï¼ˆç‰¹è‰²æ¨¡å—æ¡ç›®ä¼šä»GiståŠ è½½ï¼‰</p></div></div>

<script>
    // JavaScript é­”æ³•å¼€å§‹ï¼
    console.log("[é­”æ³•ä¹å›­æ—¥å¿— V14.2 Gisté“¾æ¥å†æ¬¡æ›´æ–°ç‰ˆ] è„šæœ¬å¼€å§‹è¿è¡Œï¼");

document.addEventListener('DOMContentLoaded', async function() {
    console.log("[é­”æ³•ä¹å›­æ—¥å¿— V14.2 Gisté“¾æ¥å†æ¬¡æ›´æ–°ç‰ˆ] DOMå®Œå…¨åŠ è½½ï¼Œå‡†å¤‡åŠ è½½å¤–éƒ¨æ•°æ®ã€‚");

    const rootElement = document.documentElement;
    if (!rootElement) console.error("[LOG] CRITICAL: rootElement (html) æœªæ‰¾åˆ°!");

    // --- Gist Raw URLS (ä½¿ç”¨ç”œç”œæœ€æ–°æä¾›çš„é“¾æ¥) ---
    const PROMPTS_GIST_URL = 'https://gist.githubusercontent.com/123g-stack/44ba2dc940723c1cc3adfe65445321a4/raw/23221be277a73165140aea8e97f8f10e93c5779e/prompts.json';
    const STORIES_GIST_URL = 'https://gist.githubusercontent.com/123g-stack/9143bd88dd6cd7c88d0d5efe3d131645/raw/5aa850b34c7e93fedf03a4978e6bad5646fd048e/stories.json';
    const PERSONA_ITEMS_GIST_URL = 'https://gist.githubusercontent.com/123g-stack/e0667bc86614abdc92d12254997b369d/raw/2be6b93bbc222baa9ea2cc164c81929890c30f8f/personaItems.json';
    const MODULE_DATA_GIST_URL = ' https://gist.githubusercontent.com/123g-stack/45afe17dbd91ebb37a6daffb1debb30a/raw/d95659d0ccbae794fa692d6f7b0b99fef1034157/moduleData.json';

    // --- åˆå§‹åŒ–æ•°æ®å˜é‡ (ç”¨å¤‡ç”¨æ•°æ®ä½œä¸ºåˆå§‹å€¼å’ŒåŠ è½½å¤±è´¥çš„åå¤‡) ---
    let prompts = ["åŠ è½½ä¸­ï¼Œè¯·ç¨å€™..."];
    let stories = { common: [{title:"åŠ è½½ä¸­...", content:"è¯·ç¨å€™..."}] };
    let personaItems = ["åŠ è½½ä¸­ï¼Œè¯·ç¨å€™..."];
    let moduleData = {
        pureLove: { items: ["åŠ è½½ä¸­..."], currentPage: 1 },
        privateRealm: { items: ["åŠ è½½ä¸­..."], currentPage: 1 }
    };
    let allDataLoadedSuccessfully = true; 

    // --- UIå…ƒç´ è·å– ---
    const promptGachaDisplay = document.getElementById('prompt-gacha-display');
    const storyDisplayContentElement = document.getElementById('story-content');
    const personaTraitDisplay = document.getElementById('persona-trait-display');
    const pureLoveItemDisplay = document.getElementById('pureLove-item-display');
    const privateRealmItemDisplay = document.getElementById('privateRealm-item-display');

    // --- å¼‚æ­¥åŠ è½½æ•°æ®çš„å‡½æ•° ---
    async function fetchData(url, fallbackData, dataName) {
        if (dataName === 'Prompts' && promptGachaDisplay) promptGachaDisplay.innerHTML = '<p class="loading-message">çµæ„ŸåŠ è½½ä¸­...</p>';
        if (dataName === 'Stories' && storyDisplayContentElement) storyDisplayContentElement.innerHTML = '<p class="loading-message">æ•…äº‹åŠ è½½ä¸­...</p>';
        if (dataName === 'PersonaItems' && personaTraitDisplay) personaTraitDisplay.innerHTML = '<p class="loading-message">äººè®¾åŠ è½½ä¸­...</p>';
        if (dataName === 'ModuleData') {
            if(pureLoveItemDisplay) pureLoveItemDisplay.innerHTML = '<p class="loading-message">çº¯çˆ±å°å±‹å†…å®¹åŠ è½½ä¸­...</p>';
            if(privateRealmItemDisplay) privateRealmItemDisplay.innerHTML = '<p class="loading-message">ç¥ç§˜èŠ±å›­å†…å®¹åŠ è½½ä¸­...</p>';
        }

        try {
            if (url.trim() === '' || url.includes("ã€") || url.includes("å ä½ç¬¦")) {
                console.warn(`[LOG] ${dataName}ä½¿ç”¨çš„æ˜¯å ä½ç¬¦URLæˆ–URLä¸ºç©º ('${url}')ï¼Œå°†ä½¿ç”¨å¤‡ç”¨æ•°æ®ã€‚`);
                throw new Error('Placeholder or empty URL for ' + dataName);
            }
            const response = await fetch(url, { cache: "no-store" }); 
            if (!response.ok) {
                throw new Error(`ç½‘ç»œè¯·æ±‚ ${dataName} å¤±è´¥: ${response.status} ${response.statusText} (URL: ${url})`);
            }
            const jsonData = await response.json();
            console.log(`[LOG] ${dataName} æ•°æ®å·²æˆåŠŸä»GiståŠ è½½ï¼ å†…å®¹ç‰‡æ®µ:`, JSON.stringify(jsonData).substring(0,100));
            return jsonData;
        } catch (error) {
            console.error(`[LOG] åŠ è½½ ${dataName} æ•°æ®å¤±è´¥:`, error.message, `å°†ä½¿ç”¨å¤‡ç”¨æ•°æ®ã€‚`);
            allDataLoadedSuccessfully = false; 
            return fallbackData;
        }
    }

    // --- ç­‰å¾…æ‰€æœ‰æ ¸å¿ƒæ•°æ®åŠ è½½å®Œæˆ ---
    try {
        [
            prompts,
            stories,
            personaItems,
            moduleData
        ] = await Promise.all([
            fetchData(PROMPTS_GIST_URL, ["å¤‡ç”¨æç¤º1ï¼šGisté“¾æ¥æ— æ•ˆæˆ–ç½‘ç»œä¸ä½³ã€‚", "å¤‡ç”¨æç¤º2ï¼šè¯·æ£€æŸ¥Gisté“¾æ¥ã€‚"], 'Prompts'),
            fetchData(STORIES_GIST_URL, { common: [{title:"å¤‡ç”¨æ•…äº‹", content:"Gisté“¾æ¥æ— æ•ˆæˆ–ç½‘ç»œä¸ä½³ã€‚"}] }, 'Stories'),
            fetchData(PERSONA_ITEMS_GIST_URL, ["å¤‡ç”¨äººè®¾1ï¼šGisté“¾æ¥å¯èƒ½æ— æ•ˆã€‚", "å¤‡ç”¨äººè®¾2ï¼šæ£€æŸ¥ç½‘ç»œã€‚"], 'PersonaItems'),
            fetchData(MODULE_DATA_GIST_URL, { 
                pureLove: { items: ["å¤‡ç”¨çº¯çˆ±æ¡ç›®ï¼šGisté“¾æ¥é—®é¢˜ã€‚"], currentPage: 1 }, 
                privateRealm: { items: ["å¤‡ç”¨ç¥ç§˜æ¡ç›®ï¼šGisté“¾æ¥é—®é¢˜ã€‚"], currentPage: 1 } 
            }, 'ModuleData')
        ]);
        
        console.log("[LOG] æ‰€æœ‰æ ¸å¿ƒå¤–éƒ¨æ•°æ®å‡å·²å°è¯•åŠ è½½å®Œæ¯•ï¼");
        console.log("[LOG] Prompts åŠ è½½å: ", prompts);
        console.log("[LOG] Stories åŠ è½½å: ", stories);
        console.log("[LOG] PersonaItems åŠ è½½å: ", personaItems);
        console.log("[LOG] ModuleData åŠ è½½å: ", moduleData);


        if(promptGachaDisplay) promptGachaDisplay.innerHTML = '<p class="placeholder-text">ç‚¹æŒ‰é’®æ‘‡Promptå§ï¼</p>';
        if(storyDisplayContentElement) storyDisplayContentElement.innerHTML = '<p class="placeholder-text">æŠ½åˆ°çš„æ•…äº‹ä¼šæ˜¾ç¤ºåœ¨è¿™ï¼</p>';
        if(personaTraitDisplay) personaTraitDisplay.innerHTML = '<p class="placeholder-text">ä»Šå¤©ä¼šæ˜¯ä»€ä¹ˆæ ·çš„æˆ‘å‘¢ï¼Ÿ</p>';
        
        const activeButton = document.querySelector('.module-btn.active');
        if (activeButton) {
            const activeModule = activeButton.dataset.module;
            if (moduleData && moduleData[activeModule] && moduleData[activeModule].items && moduleData[activeModule].items.length > 0 && !(moduleData[activeModule].items.length > 0 && moduleData[activeModule].items[0].includes("å¤‡ç”¨"))) {
                moduleData[activeModule].currentPage = 1;
                displayModuleItems(activeModule); 
            } else { 
                const displayElement = document.getElementById(`${activeModule}-item-display`);
                if(displayElement) displayElement.innerHTML = `<p class="placeholder-text" style="color:red;">${activeModule} æ¨¡å—å†…å®¹åŠ è½½å¤±è´¥æˆ–ä¸ºç©º!</p>`;
            }
        } else { 
             if(pureLoveItemDisplay && document.getElementById('content-pureLove').style.display === 'block') {
                if (moduleData.pureLove && moduleData.pureLove.items && moduleData.pureLove.items.length > 0 && !(moduleData.pureLove.items.length > 0 && moduleData.pureLove.items[0].includes("å¤‡ç”¨"))) displayModuleItems('pureLove');
                else if(pureLoveItemDisplay) pureLoveItemDisplay.innerHTML = '<p class="placeholder-text">çº¯çˆ±å°å±‹å†…å®¹åŠ è½½å¤±è´¥æˆ–ä¸ºç©º...</p>';
             }
             if(privateRealmItemDisplay && document.getElementById('content-privateRealm').style.display === 'block'){
                if (moduleData.privateRealm && moduleData.privateRealm.items && moduleData.privateRealm.items.length > 0 && !(moduleData.privateRealm.items.length > 0 && moduleData.privateRealm.items[0].includes("å¤‡ç”¨"))) displayModuleItems('privateRealm');
                else if(privateRealmItemDisplay) privateRealmItemDisplay.innerHTML = '<p class="placeholder-text">ç¥ç§˜èŠ±å›­å†…å®¹åŠ è½½å¤±è´¥æˆ–ä¸ºç©º...</p>';
             }
        }

    } catch (error) {
        console.error("[LOG] Promise.all åŠ è½½æ•°æ®æ—¶å‘ç”Ÿæ„å¤–é”™è¯¯:", error);
        allDataLoadedSuccessfully = false; 
        if(promptGachaDisplay) promptGachaDisplay.innerHTML = '<p class="placeholder-text" style="color:red;">éƒ¨åˆ†æ ¸å¿ƒæ•°æ®åŠ è½½å¤±è´¥ï¼ŒåŠŸèƒ½å¯èƒ½å—é™ã€‚</p>';
    }

    // =======================================================================
    //  é­”æ³•ä¹å›­çš„å…¶ä»–æ‰€æœ‰JavaScripté€»è¾‘ä»£ç  (åŸºäºV13ç‰ˆæœ¬)
    // =======================================================================

    // --- ä¸»é¢˜é¢œè‰²åˆ‡æ¢åŠŸèƒ½ ---
    const themeButtons = document.querySelectorAll('.theme-buttons .theme-btn');
    const themes = { 
            pink: { '--primary-bg-color': '#fff0f5', '--primary-text-color': '#5d3c50', '--theme-accent-color': '#ff69b4', '--feature-bg-color': '#ffffff', '--feature-border-color': '#ffc0cb', '--gacha-button-text-color': '#ffffff', '--draw-method-bg-color': '#ffe4e1', '--draw-method-border-color': '#ff69b4', '--draw-method-text-color': '#c71585', '--draw-method-hover-bg-color': '#ffb6c1', '--stamina-bar-bg-color': '#ff69b4', '--story-content-bg-color': '#fffafa', '--story-content-border-color': '#ffb6c1', '--placeholder-text-color': '#a07080', '--story-title-color': '#ff69b4', '--module-button-active-bg': '#ff69b4', '--module-button-active-text': '#ffffff', '--module-button-bg': '#ffe4e1', '--module-button-text': '#c71585', '--pagination-btn-bg': '#ff69b4', '--pagination-btn-text': '#ffffff', '--pagination-btn-disabled-bg': '#ffdbe7', '--pagination-btn-disabled-text': '#ff8cc6'},
            blue: { '--primary-bg-color': '#e0f7fa', '--primary-text-color': '#004d40', '--theme-accent-color': '#00bcd4', '--feature-bg-color': '#ffffff', '--feature-border-color': '#b2ebf2', '--gacha-button-text-color': '#004d40', '--draw-method-bg-color': '#e0f7fa', '--draw-method-border-color': '#00bcd4', '--draw-method-text-color': '#00796b', '--draw-method-hover-bg-color': '#b2ebf2', '--stamina-bar-bg-color': '#00acc1', '--story-content-bg-color': '#f0f8ff', '--story-content-border-color': '#81d4fa', '--placeholder-text-color': '#546e7a', '--story-title-color': '#00bcd4', '--module-button-active-bg': '#00bcd4', '--module-button-active-text': '#ffffff', '--module-button-bg': '#e0f7fa', '--module-button-text': '#00796b', '--pagination-btn-bg': '#00bcd4', '--pagination-btn-text': '#ffffff', '--pagination-btn-disabled-bg': '#b3e5fc', '--pagination-btn-disabled-text': '#007ac1'},
            green: {'--primary-bg-color': '#e8f5e9', '--primary-text-color': '#1b5e20', '--theme-accent-color': '#4caf50', '--feature-bg-color': '#ffffff', '--feature-border-color': '#c8e6c9', '--gacha-button-text-color': '#ffffff', '--draw-method-bg-color': '#e8f5e9', '--draw-method-border-color': '#4caf50', '--draw-method-text-color': '#2e7d32', '--draw-method-hover-bg-color': '#c8e6c9', '--stamina-bar-bg-color': '#388e3c', '--story-content-bg-color': '#f1f8e9', '--story-content-border-color': '#a5d6a7', '--placeholder-text-color': '#556b2f', '--story-title-color': '#4caf50', '--module-button-active-bg': '#4caf50', '--module-button-active-text': '#ffffff', '--module-button-bg': '#e8f5e9', '--module-button-text': '#2e7d32', '--pagination-btn-bg': '#4caf50', '--pagination-btn-text': '#ffffff', '--pagination-btn-disabled-bg': '#c8e6c9', '--pagination-btn-disabled-text': '#388e3c'},
            orange: {'--primary-bg-color': '#fff3e0', '--primary-text-color': '#e65100', '--theme-accent-color': '#ff9800', '--feature-bg-color': '#ffffff', '--feature-border-color': '#ffe0b2', '--gacha-button-text-color': '#8c0000', '--draw-method-bg-color': '#fff3e0', '--draw-method-border-color': '#ff9800', '--draw-method-text-color': '#f57c00', '--draw-method-hover-bg-color': '#ffe0b2', '--stamina-bar-bg-color': '#fb8c00', '--story-content-bg-color': '#fff8e1', '--story-content-border-color': '#ffcc80', '--placeholder-text-color': '#bf360c', '--story-title-color': '#ff9800', '--module-button-active-bg': '#ff9800', '--module-button-active-text': '#ffffff', '--module-button-bg': '#fff3e0', '--module-button-text': '#f57c00', '--pagination-btn-bg': '#ff9800', '--pagination-btn-text': '#ffffff', '--pagination-btn-disabled-bg': '#ffe0b2', '--pagination-btn-disabled-text': '#e65100'},
            purple: {'--primary-bg-color': '#f3e5f5', '--primary-text-color': '#4a148c', '--theme-accent-color': '#9c27b0', '--feature-bg-color': '#ffffff', '--feature-border-color': '#e1bee7', '--gacha-button-text-color': '#ffffff', '--draw-method-bg-color': '#f3e5f5', '--draw-method-border-color': '#9c27b0', '--draw-method-text-color': '#7b1fa2', '--draw-method-hover-bg-color': '#e1bee7', '--stamina-bar-bg-color': '#8e24aa', '--story-content-bg-color': '#f9f0ff', '--story-content-border-color': '#d1c4e9', '--placeholder-text-color': '#6a1b9a', '--story-title-color': '#9c27b0', '--module-button-active-bg': '#9c27b0', '--module-button-active-text': '#ffffff', '--module-button-bg': '#f3e5f5', '--module-button-text': '#7b1fa2', '--pagination-btn-bg': '#9c27b0', '--pagination-btn-text': '#ffffff', '--pagination-btn-disabled-bg': '#e1bee7', '--pagination-btn-disabled-text': '#6a1b9a'},
            yellow: {'--primary-bg-color': '#fffde7', '--primary-text-color': '#f57f17', '--theme-accent-color': '#fdd835', '--feature-bg-color': '#ffffff', '--feature-border-color': '#fff9c4', '--gacha-button-text-color': '#827717', '--draw-method-bg-color': '#fffde7', '--draw-method-border-color': '#fdd835', '--draw-method-text-color': '#fbc02d', '--draw-method-hover-bg-color': '#fff9c4', '--stamina-bar-bg-color': '#fbc02d', '--story-content-bg-color': '#floralwhite', '--story-content-border-color': '#fff59d', '--placeholder-text-color': '#b28704', '--story-title-color': '#fdd835', '--module-button-active-bg': '#fdd835', '--module-button-active-text': '#827717', '--module-button-bg': '#fffde7', '--module-button-text': '#fbc02d', '--pagination-btn-bg': '#fdd835', '--pagination-btn-text': '#827717', '--pagination-btn-disabled-bg': '#fff9c4', '--pagination-btn-disabled-text': '#c49000'},
            dark: { '--primary-bg-color': '#212121', '--primary-text-color': '#e0e0e0', '--theme-accent-color': '#757575', '--feature-bg-color': '#303030', '--feature-border-color': '#424242', '--gacha-button-text-color': '#ffffff', '--draw-method-bg-color': '#424242', '--draw-method-border-color': '#757575', '--draw-method-text-color': '#e0e0e0', '--draw-method-hover-bg-color': '#525252', '--stamina-bar-bg-color': '#616161', '--story-content-bg-color': '#262626', '--story-content-border-color': '#616161', '--placeholder-text-color': '#9e9e9e', '--story-title-color': '#757575', '--module-button-active-bg': '#757575', '--module-button-active-text': '#212121', '--module-button-bg': '#424242', '--module-button-text': '#e0e0e0', '--pagination-btn-bg': '#757575', '--pagination-btn-text': '#212121', '--pagination-btn-disabled-bg': '#424242', '--pagination-btn-disabled-text': '#9e9e9e'}
    };
    if (themeButtons.length > 0) { themeButtons.forEach(button => { button.addEventListener('click', function() { const themeName = this.dataset.theme; rootElement.style.setProperty('--current-theme-name', themeName); const selectedTheme = themes[themeName]; if (selectedTheme) { for (const variable in selectedTheme) { rootElement.style.setProperty(variable, selectedTheme[variable]); } } updateStaminaVisuals(); updateModuleButtonStyles(); updateAllPaginationButtonsStyle(); }); });} else { console.warn("[LOG] æœªæ‰¾åˆ°ä¸»é¢˜æŒ‰é’®ã€‚");}
    
    // --- ä½“åŠ›å€¼ç³»ç»Ÿ ---
    const staminaDisplayElement = document.getElementById('stamina-value-display'); const staminaBarElement = document.getElementById('stamina-bar'); let currentStamina = 100; const maxStamina = 100; const staminaCostPerDraw = 10; const staminaRegenAmount = 1; const staminaRegenInterval = 5000; function updateStaminaVisuals() { if (!staminaDisplayElement || !staminaBarElement) { return; } staminaDisplayElement.textContent = currentStamina; const percentage = (currentStamina / maxStamina) * 100; staminaBarElement.style.width = percentage + '%'; staminaBarElement.textContent = Math.round(percentage) + '%'; const currentThemeName = rootElement.style.getPropertyValue('--current-theme-name') || 'blue'; const currentThemeColors = themes[currentThemeName]; let staminaBarColor = currentThemeColors ? currentThemeColors['--stamina-bar-bg-color'] : '#00acc1'; if (percentage < 30) { staminaBarColor = '#d9534f'; } else if (percentage < 60) { staminaBarColor = '#f0ad4e'; } staminaBarElement.style.backgroundColor = staminaBarColor; const drawMethodButtons = document.querySelectorAll('.draw-method'); drawMethodButtons.forEach(btn => { if (currentStamina < staminaCostPerDraw) { btn.classList.add('disabled'); btn.title = "ä½“åŠ›ä¸è¶³å•¦ï¼"; } else { btn.classList.remove('disabled'); btn.title = ""; } }); } function regenerateStamina() { if (currentStamina < maxStamina) { currentStamina += staminaRegenAmount; if (currentStamina > maxStamina) { currentStamina = maxStamina; } updateStaminaVisuals(); } } setInterval(regenerateStamina, staminaRegenInterval); updateStaminaVisuals(); 
    
    // --- Promptæ‘‡è›‹æœº åŠŸèƒ½ ---
    const gachaPromptButton = document.getElementById('gacha-prompt-button');
    if (gachaPromptButton && promptGachaDisplay) { gachaPromptButton.addEventListener('click', function() { if (!allDataLoadedSuccessfully && prompts[0].includes("å¤‡ç”¨") ) { promptGachaDisplay.innerHTML = '<p class="loading-message">æç¤ºè¯è¿˜åœ¨åŠªåŠ›åŠ è½½ä¸­æˆ–åŠ è½½å¤±è´¥ï¼Œè¯·ç¨ç­‰æˆ–æ£€æŸ¥Gisté“¾æ¥~</p>'; return; } this.classList.add('shake-animation'); setTimeout(() => { this.classList.remove('shake-animation'); }, 500); if (!prompts || prompts.length === 0 || (prompts.length > 0 && prompts[0].includes("å¤‡ç”¨"))) { promptGachaDisplay.innerHTML = '<p class="placeholder-text" style="color:orange;">å“å‘€ï¼Œçµæ„Ÿæ± å¥½åƒç©ºäº†ï¼(æˆ–è€…æ²¡åŠ è½½æˆåŠŸ)</p>'; return; } const randomIndex = Math.floor(Math.random() * prompts.length); const randomPrompt = prompts[randomIndex]; promptGachaDisplay.innerHTML = ''; setTimeout(() => { const promptTextElement = document.createElement('p'); promptTextElement.textContent = randomPrompt; promptGachaDisplay.appendChild(promptTextElement); }, 150); }); } else { console.error("[LOG] æ‘‡è›‹æœºæŒ‰é’®æˆ–æ˜¾ç¤ºåŒºæœªæ‰¾åˆ°ã€‚"); }
    
    // --- æ•…äº‹æ•°æ®å’ŒæŠ½å–é€»è¾‘ ---
    if (!storyDisplayContentElement) console.error("[LOG] CRITICAL: storyDisplayContentElement æœªæ‰¾åˆ°!"); 
    function drawStory() { if (!allDataLoadedSuccessfully && stories.common && stories.common.length > 0 && stories.common[0]?.title === "å¤‡ç”¨æ•…äº‹" ) { storyDisplayContentElement.innerHTML = '<p class="loading-message">æ•…äº‹è¿˜åœ¨åŠªåŠ›åŠ è½½ä¸­æˆ–åŠ è½½å¤±è´¥ï¼Œè¯·ç¨ç­‰æˆ–æ£€æŸ¥Gisté“¾æ¥~</p>'; return; } if (!storyDisplayContentElement) { return; } if (currentStamina < staminaCostPerDraw) { storyDisplayContentElement.innerHTML = `<p class="placeholder-text" style="color: red; font-weight: bold;">ä½“åŠ›ä¸è¶³ï¼Œæ— æ³•æŠ½å–æ•…äº‹å•¦ï¼</p>`; return; } const rarityKeys = Object.keys(stories); if (rarityKeys.length === 0 || (rarityKeys.length === 1 && rarityKeys[0] === "common" && stories.common[0]?.title === "å¤‡ç”¨æ•…äº‹") ) { storyDisplayContentElement.innerHTML = `<p class="placeholder-text" style="color:orange;">æ•…äº‹ä¹¦æ˜¯ç©ºçš„ï¼(æˆ–è€…æ²¡åŠ è½½æˆåŠŸ)</p>`; return; } let randomRarityKey = rarityKeys[Math.floor(Math.random() * rarityKeys.length)]; let storiesInRarity = stories[randomRarityKey]; if (!storiesInRarity || storiesInRarity.length === 0) { // å¦‚æœæŸä¸ªç¨€æœ‰åº¦åˆ†ç±»æ˜¯ç©ºçš„ï¼Œå°è¯•ä¸‹ä¸€ä¸ª
        let attempts = 0;
        while ((!storiesInRarity || storiesInRarity.length === 0) && attempts < rarityKeys.length) {
            randomRarityKey = rarityKeys[Math.floor(Math.random() * rarityKeys.length)];
            storiesInRarity = stories[randomRarityKey];
            attempts++;
        }
        if (!storiesInRarity || storiesInRarity.length === 0) {
             storyDisplayContentElement.innerHTML = `<p class="placeholder-text" style="color:orange;">æ‰€æœ‰ç±»åˆ«çš„æ•…äº‹éƒ½æš‚æ—¶æ²¡æœ‰å“¦ï¼</p>`; return;
        }
    } let randomStory = storiesInRarity[Math.floor(Math.random() * storiesInRarity.length)]; if (!randomStory || typeof randomStory.title === 'undefined' || typeof randomStory.content === 'undefined') { storyDisplayContentElement.innerHTML = `<p class="placeholder-text" style="color:red;">æŠ½åˆ°ç©ºç™½é¡µï¼</p>`; return; } storyDisplayContentElement.innerHTML = `<h3>${randomStory.title}</h3><p>${randomStory.content}</p>`; currentStamina -= staminaCostPerDraw; updateStaminaVisuals(); } 
    function setupAnimatedDrawButton(buttonId, processingText, animationClass, animationDuration = 700) { const button = document.getElementById(buttonId); if (button && storyDisplayContentElement) { button.addEventListener('click', function() { if (this.classList.contains('disabled')) { return; } const originalText = this.innerHTML; const originalCursor = this.style.cursor; this.innerHTML = processingText || "æŠ½å–ä¸­..."; this.classList.add('disabled'); this.style.cursor = 'wait'; if (animationClass) { this.classList.add(animationClass); } if (currentStamina >= staminaCostPerDraw && allDataLoadedSuccessfully) { storyDisplayContentElement.innerHTML = `<p class="placeholder-text">æ­£åœ¨æŠ½å–...</p>`; } else if (!allDataLoadedSuccessfully) { storyDisplayContentElement.innerHTML = `<p class="loading-message">æ•°æ®åŠ è½½ä¸­/å¤±è´¥ï¼Œè¯·ç¨å...</p>`; } setTimeout(() => { if (animationClass) { this.classList.remove(animationClass); } drawStory(); this.innerHTML = originalText; this.style.cursor = originalCursor; if (currentStamina < staminaCostPerDraw) { this.classList.add('disabled');} else { this.classList.remove('disabled'); } }, animationDuration); }); } else { if (!button) console.error(`[LOG] åŠ¨ç”»æŒ‰é’® #${buttonId} æœªæ‰¾åˆ°`); } }
    setupAnimatedDrawButton('draw-darts', 'ğŸ¯ å‘½ä¸­ç›®æ ‡...', 'dart-throw-animation', 500); setupAnimatedDrawButton('draw-slot-machine', 'ğŸ° è½¬åŠ¨ä¸­...', 'slot-spin-animation', 600); setupAnimatedDrawButton('draw-coin-toss', 'ğŸª™ å‘½è¿ä¸€æ·...', 'coin-flip-animation', 700); setupAnimatedDrawButton('draw-cat-paw', 'ğŸ¾ å–µåŠ›å‡ºå‡»...', 'cat-paw-animation', 400); setupAnimatedDrawButton('draw-balloon', 'ğŸˆ æˆ³ç ´æƒŠå–œ...', 'balloon-wiggle-animation', 700); const clawMachineButton = document.getElementById('draw-claw-machine'); if (clawMachineButton && storyDisplayContentElement) { clawMachineButton.addEventListener('click', function() { if (this.classList.contains('disabled')) { return; } const originalText = this.innerHTML; const originalCursor = this.style.cursor; this.innerHTML = "ğŸ§¸ æŠ“å–ä¸­..."; this.classList.add('disabled'); this.style.cursor = 'wait'; this.classList.add('is-grabbing'); if (currentStamina >= staminaCostPerDraw && allDataLoadedSuccessfully) { storyDisplayContentElement.innerHTML = `<p class="placeholder-text">å¨ƒå¨ƒæœºåŠªåŠ›æŠ“å–ä¸­...</p>`;} else if (!allDataLoadedSuccessfully) { storyDisplayContentElement.innerHTML = `<p class="loading-message">æ•°æ®åŠ è½½ä¸­/å¤±è´¥ï¼Œè¯·ç¨å...</p>`; } setTimeout(() => { this.classList.remove('is-grabbing'); drawStory(); this.innerHTML = originalText; this.style.cursor = originalCursor; if (currentStamina < staminaCostPerDraw) { this.classList.add('disabled'); } else { this.classList.remove('disabled'); } }, 700); });}
    
    // --- äººè®¾å¨ƒå¨ƒæœºåŠŸèƒ½ ---
    const personaClawMachine = document.getElementById('persona-claw-machine-trigger');
    if (personaClawMachine && personaTraitDisplay) { personaClawMachine.addEventListener('click', function() { if (!allDataLoadedSuccessfully && personaItems[0].includes("å¤‡ç”¨") ) { personaTraitDisplay.innerHTML = '<p class="loading-message">äººè®¾è¿˜åœ¨åŠªåŠ›åŠ è½½ä¸­æˆ–åŠ è½½å¤±è´¥ï¼Œè¯·ç¨ç­‰æˆ–æ£€æŸ¥Gisté“¾æ¥~</p>'; return; } this.classList.add('persona-machine-shake'); personaTraitDisplay.innerHTML = '<p class="placeholder-text">æŠ“å–ä»Šæ—¥äººè®¾ä¸­...</p>'; setTimeout(() => { this.classList.remove('persona-machine-shake'); if (!personaItems || personaItems.length === 0 || (personaItems.length > 0 && personaItems[0].includes("å¤‡ç”¨"))) { personaTraitDisplay.innerHTML = '<p class="placeholder-text" style="color:orange;">äººè®¾æ± ç©ºå•¦ï¼(æˆ–è€…æ²¡åŠ è½½æˆåŠŸ)</p>'; return; } const randomIndex = Math.floor(Math.random() * personaItems.length); const randomPersonaTrait = personaItems[randomIndex]; personaTraitDisplay.innerHTML = ''; const traitTextElement = document.createElement('p'); traitTextElement.textContent = randomPersonaTrait; personaTraitDisplay.appendChild(traitTextElement); }, 700); }); } else { console.error("[LOG] äººè®¾å¨ƒå¨ƒæœºæˆ–æ˜¾ç¤ºåŒºæœªæ‰¾åˆ°ã€‚"); }
    
    // --- å¤åˆ¶æ–‡æœ¬åˆ°å‰ªè´´æ¿çš„è¾…åŠ©å‡½æ•° ---
    async function copyTextToClipboard(text, buttonElement, successMessage = 'å·²å¤åˆ¶ âœ“') { if (!text || text.trim() === '' || (buttonElement && buttonElement.textContent.includes('å·²å¤åˆ¶'))) { if (text.trim() === '' && buttonElement) { const originalText = buttonElement.dataset.originalText || buttonElement.textContent; buttonElement.textContent = 'å†…å®¹ä¸ºç©º!'; setTimeout(() => { buttonElement.textContent = originalText; }, 1500); } return; } const originalButtonText = buttonElement ? (buttonElement.dataset.originalText || buttonElement.innerHTML) : ''; if (buttonElement && !buttonElement.dataset.originalText) buttonElement.dataset.originalText = originalButtonText; try { await navigator.clipboard.writeText(text); if (buttonElement) { buttonElement.innerHTML = successMessage; buttonElement.classList.add('copied-feedback'); setTimeout(() => { buttonElement.innerHTML = originalButtonText; buttonElement.classList.remove('copied-feedback'); delete buttonElement.dataset.originalText; }, 2000); } } catch (err) { console.error('[LOG] å¤åˆ¶æ–‡æœ¬å¤±è´¥:', err); if (buttonElement) { buttonElement.innerHTML = 'å¤åˆ¶å¤±è´¥!'; setTimeout(() => { buttonElement.innerHTML = originalButtonText; delete buttonElement.dataset.originalText; }, 2000); } } }
    
    // --- å„åŒºåŸŸå¤åˆ¶æŒ‰é’®äº‹ä»¶ç›‘å¬ ---
    const copyPromptBtn = document.getElementById('copy-prompt-btn'); if (copyPromptBtn && promptGachaDisplay) { copyPromptBtn.addEventListener('click', function() { const promptTextElement = promptGachaDisplay.querySelector('p:not(.placeholder-text):not(.loading-message)'); const textToCopy = promptTextElement ? promptTextElement.textContent : ''; if (textToCopy.trim() !== '') { copyTextToClipboard(textToCopy.trim(), this, 'çµæ„Ÿå·²å¤åˆ¶!'); } else { copyTextToClipboard('', this); } }); }
    const copyStoryBtn = document.getElementById('copy-story-btn'); if (copyStoryBtn && storyDisplayContentElement) { copyStoryBtn.addEventListener('click', function() { const titleElement = storyDisplayContentElement.querySelector('h3'); const contentElement = storyDisplayContentElement.querySelector('p:not(.placeholder-text):not(.loading-message)'); let textToCopy = ""; if (titleElement) textToCopy += titleElement.textContent.trim(); if (contentElement) { if (textToCopy !== "") textToCopy += "\n\n"; textToCopy += contentElement.textContent.trim(); } if (textToCopy.trim() !== '') { copyTextToClipboard(textToCopy, this, 'æ•…äº‹å·²å¤åˆ¶!'); } else { copyTextToClipboard('', this); } }); }
    const copyPersonaBtn = document.getElementById('copy-persona-btn'); if (copyPersonaBtn && personaTraitDisplay) { copyPersonaBtn.addEventListener('click', function() { const personaTextElement = personaTraitDisplay.querySelector('p:not(.placeholder-text):not(.loading-message)'); const textToCopy = personaTextElement ? personaTextElement.textContent : ''; if (textToCopy.trim() !== '') { copyTextToClipboard(textToCopy.trim(), this, 'äººè®¾å·²å¤åˆ¶!'); } else { copyTextToClipboard('', this); } }); }
    
    // --- ç‰¹è‰²æ¨¡å—åˆ‡æ¢åŠŸèƒ½ ---
    const paperballTrigger = document.getElementById('paperball-trigger'); const moduleButtonsContainer = document.querySelector('.module-buttons-container'); const moduleContents = document.querySelectorAll('.module-content'); const moduleButtons = document.querySelectorAll('.module-btn');
    const itemsPerPage = 2; 
    if (paperballTrigger && moduleButtonsContainer) { paperballTrigger.addEventListener('click', function() { if (moduleButtonsContainer.style.display === 'none' || moduleButtonsContainer.style.display === '') { moduleButtonsContainer.style.display = 'flex'; this.textContent = 'ğŸ“„ æ”¶èµ·é—®å·å…¥å£~';} else { moduleButtonsContainer.style.display = 'none'; this.textContent = 'ğŸ“„ ç‚¹æˆ‘å±•å¼€é—®å·å…¥å£~'; moduleContents.forEach(content => content.style.display = 'none'); moduleButtons.forEach(btn => btn.classList.remove('active')); updateModuleButtonStyles(); }}); } else { console.error("[LOG] çº¸å›¢æˆ–æ¨¡å—æŒ‰é’®å®¹å™¨æœªæ‰¾åˆ°ã€‚"); }
    function displayModuleItems(moduleName) { if (!allDataLoadedSuccessfully && (!moduleData[moduleName] || !moduleData[moduleName].items || (moduleData[moduleName].items.length > 0 && moduleData[moduleName].items[0].includes("å¤‡ç”¨"))) ) { const displayElement = document.getElementById(`${moduleName}-item-display`); if(displayElement) displayElement.innerHTML = '<p class="loading-message">æ¨¡å—å†…å®¹è¿˜åœ¨åŠªåŠ›åŠ è½½ä¸­æˆ–åŠ è½½å¤±è´¥ï¼Œè¯·ç¨ç­‰æˆ–æ£€æŸ¥Gisté“¾æ¥~</p>'; return; } const moduleConfig = moduleData[moduleName]; if (!moduleConfig || !moduleConfig.items) { console.error(`[LOG] æ¨¡å—æ•°æ® ${moduleName} æˆ–å…¶ items æœªæ‰¾åˆ°/åŠ è½½æˆåŠŸ`); const displayElement = document.getElementById(`${moduleName}-item-display`); if(displayElement) displayElement.innerHTML = '<p class="placeholder-text" style="color:red;">æ¨¡å—å†…å®¹åŠ è½½å¤±è´¥!</p>'; return; } const displayElement = document.getElementById(`${moduleName}-item-display`); const pageInfoElement = document.getElementById(`${moduleName}-page-info`); const prevButton = document.getElementById(`${moduleName}-prev-btn`); const nextButton = document.getElementById(`${moduleName}-next-btn`); if (!displayElement || !pageInfoElement || !prevButton || !nextButton) { console.error(`[LOG] æ¨¡å— ${moduleName} DOMå…ƒç´ ä¸å…¨`); return; } displayElement.innerHTML = ''; const startIndex = (moduleConfig.currentPage - 1) * itemsPerPage; const endIndex = startIndex + itemsPerPage; const paginatedItems = moduleConfig.items.slice(startIndex, endIndex); if (paginatedItems.length === 0 && moduleConfig.items.length > 0 && !(moduleConfig.items.length > 0 && moduleConfig.items[0].includes("å¤‡ç”¨"))) { displayElement.innerHTML = `<p class="placeholder-text">å·²ç»æ˜¯æœ€åä¸€é¡µå•¦ï¼</p>`; } else if (moduleConfig.items.length === 0 || (moduleConfig.items.length > 0 && moduleConfig.items[0].includes("å¤‡ç”¨") && (!allDataLoadedSuccessfully || moduleConfig.items[0].includes("åŠ è½½ä¸­")))) { displayElement.innerHTML = `<p class="placeholder-text">è¿™ä¸ªæ¨¡å—è¿˜æ²¡æœ‰å†…å®¹å“¦~ï¼ˆæˆ–åŠ è½½å¤±è´¥ï¼‰</p>`;} else { paginatedItems.forEach(itemText => { const p = document.createElement('p'); const textSpan = document.createElement('span'); textSpan.textContent = itemText; p.appendChild(textSpan); const copyForItemButton = document.createElement('button'); copyForItemButton.textContent = 'ğŸ“‹'; copyForItemButton.title = 'å¤åˆ¶æ­¤æ¡'; copyForItemButton.classList.add('copy-btn-item'); copyForItemButton.addEventListener('click', function(event) { event.stopPropagation(); copyTextToClipboard(itemText, this, 'æ­¤æ¡å·²å¤åˆ¶!'); }); p.appendChild(copyForItemButton); displayElement.appendChild(p); }); } const totalPages = Math.ceil(moduleConfig.items.length / itemsPerPage) || 1; pageInfoElement.textContent = `ç¬¬ ${moduleConfig.currentPage} / ${totalPages} é¡µ`; prevButton.disabled = moduleConfig.currentPage === 1; nextButton.disabled = moduleConfig.currentPage === totalPages || moduleConfig.items.length === 0 || (moduleConfig.items.length > 0 && moduleConfig.items[0].includes("å¤‡ç”¨")); updatePaginationButtonStyles(moduleName); }
    ['pureLove', 'privateRealm'].forEach(moduleName => { const copyAllBtn = document.getElementById(`${moduleName}-copy-all-btn`); if (copyAllBtn) { copyAllBtn.addEventListener('click', function() { if (!allDataLoadedSuccessfully && (!moduleData[moduleName] || !moduleData[moduleName].items || (moduleData[moduleName].items.length > 0 && moduleData[moduleName].items[0].includes("å¤‡ç”¨"))) ) { alert('æ¨¡å—å†…å®¹è¿˜åœ¨åŠ è½½ä¸­æˆ–åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åå†è¯•å“¦ï¼'); return;} const itemsToCopy = moduleData[moduleName] ? moduleData[moduleName].items : []; if (itemsToCopy && itemsToCopy.length > 0 && !(itemsToCopy.length > 0 && itemsToCopy[0].includes("å¤‡ç”¨"))) { const allItemsText = itemsToCopy.join('\n\n'); copyTextToClipboard(allItemsText, this, 'å…¨éƒ¨å·²å¤åˆ¶!'); } else { copyTextToClipboard('', this); } }); } else { console.warn(`[LOG] '${moduleName}-copy-all-btn' æœªæ‰¾åˆ°ã€‚`); } });
    if (moduleButtons.length > 0 && moduleContents.length > 0) { moduleButtons.forEach(button => { button.addEventListener('click', function() { const targetModule = this.dataset.module; if (!targetModule) { console.error("[LOG] é”™è¯¯ï¼targetModule æœªå®šä¹‰ï¼"); return; } let foundTargetContent = false; moduleContents.forEach(content => { if (content.id === `content-${targetModule}`) { foundTargetContent = true; const isActive = content.style.display === 'block'; content.style.display = isActive ? 'none' : 'block'; if (!isActive) { if (moduleData && moduleData[targetModule]) { moduleData[targetModule].currentPage = 1; try { displayModuleItems(targetModule); } catch (e) { console.error("[LOG] displayModuleItems è°ƒç”¨æ—¶å‘ç”Ÿé”™è¯¯:", e); } } else { console.error("[LOG] é”™è¯¯ï¼moduleData æˆ– moduleData['" + targetModule + "'] æœªå®šä¹‰ï¼"); const displayElement = document.getElementById(`${targetModule}-item-display`); if(displayElement) displayElement.innerHTML = '<p class="loading-message" style="color:red;">æ¨¡å—æ•°æ®åŠ è½½å¤±è´¥!</p>';} } } else { content.style.display = 'none'; } }); if (!foundTargetContent && targetModule) { console.error("[LOG] ä¸¥é‡é”™è¯¯ï¼æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ content divï¼"); } moduleButtons.forEach(btn => { const moduleDiv = document.getElementById(`content-${btn.dataset.module}`); if (moduleDiv && moduleDiv.style.display === 'block') { btn.classList.add('active'); } else { btn.classList.remove('active'); } }); try { updateModuleButtonStyles(); } catch (e) { console.error("[LOG] updateModuleButtonStyles è°ƒç”¨æ—¶å‘ç”Ÿé”™è¯¯:", e); } }); }); } else { console.warn("[LOG] æœªæ‰¾åˆ°æ¨¡å—æŒ‰é’®æˆ–æ¨¡å—å†…å®¹åŒºåŸŸã€‚"); }
    function updatePaginationButtonStyles(moduleName) { const prevButton = document.getElementById(`${moduleName}-prev-btn`); const nextButton = document.getElementById(`${moduleName}-next-btn`); if (!prevButton || !nextButton) return; const currentThemeName = rootElement.style.getPropertyValue('--current-theme-name') || 'blue'; const currentThemeColors = themes[currentThemeName]; if (!currentThemeColors) return;[prevButton, nextButton].forEach(btn => { if (btn.disabled) { btn.style.backgroundColor = currentThemeColors['--pagination-btn-disabled-bg']; btn.style.color = currentThemeColors['--pagination-btn-disabled-text']; } else { btn.style.backgroundColor = currentThemeColors['--pagination-btn-bg']; btn.style.color = currentThemeColors['--pagination-btn-text']; } }); }
    function updateAllPaginationButtonsStyle() { if (moduleData.pureLove && moduleData.pureLove.items && moduleData.pureLove.items.length > 0 && !(moduleData.pureLove.items.length > 0 && moduleData.pureLove.items[0].includes("å¤‡ç”¨"))) updatePaginationButtonStyles('pureLove'); if (moduleData.privateRealm && moduleData.privateRealm.items && moduleData.privateRealm.items.length > 0 && !(moduleData.privateRealm.items.length > 0 && moduleData.privateRealm.items[0].includes("å¤‡ç”¨"))) updatePaginationButtonStyles('privateRealm'); } 
    function updateModuleButtonStyles() { const currentThemeName = rootElement.style.getPropertyValue('--current-theme-name') || 'blue'; const currentThemeColors = themes[currentThemeName]; if (!currentThemeColors) return; moduleButtons.forEach(btn => { if (btn.classList.contains('active')) { btn.style.backgroundColor = currentThemeColors['--module-button-active-bg']; btn.style.color = currentThemeColors['--module-button-active-text']; } else { btn.style.backgroundColor = currentThemeColors['--module-button-bg']; btn.style.color = currentThemeColors['--module-button-text']; } }); }
    function setDefaultTheme() { const defaultThemeName = 'blue'; rootElement.style.setProperty('--current-theme-name', defaultThemeName); const defaultTheme = themes[defaultThemeName]; if (defaultTheme) { for (const variable in defaultTheme) { rootElement.style.setProperty(variable, defaultTheme[variable]); } } updateStaminaVisuals(); updateModuleButtonStyles(); updateAllPaginationButtonsStyle(); console.log("[LOG] é»˜è®¤ä¸»é¢˜ (Blue) å·²åº”ç”¨ã€‚"); }
    
    setDefaultTheme();

    console.log("[é­”æ³•ä¹å›­æ—¥å¿— V14.2 æœ€æ–°æ•°æ®é“¾æ¥ç‰ˆ] æ ¸å¿ƒè„šæœ¬æ‰§è¡Œå®Œæ¯•ï¼Œäº‹ä»¶ç›‘å¬å™¨å·²è®¾ç½®ã€‚æ•°æ®æ­£åœ¨ä»Gistå¼‚æ­¥åŠ è½½...");
});
</script>
</body>
</html>

